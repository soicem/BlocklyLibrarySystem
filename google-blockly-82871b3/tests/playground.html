<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blockly Playground</title>

  <script src="../blockly_uncompressed.js"></script>
  <script src="../generators/javascript.js"></script>
  <script src="../generators/javascript/logic.js"></script>
  <script src="../generators/javascript/loops.js"></script>
  <script src="../generators/javascript/math.js"></script>
  <script src="../generators/javascript/text.js"></script>
  <script src="../generators/javascript/lists.js"></script>
  <script src="../generators/javascript/colour.js"></script>
  <script src="../generators/javascript/variables.js"></script>
  <script src="../generators/javascript/variables_dynamic.js"></script>
  <script src="../generators/javascript/procedures.js"></script>
  <script src="../generators/javascript/import.js"></script>
  <script src="../generators/python.js"></script>
  <script src="../generators/python/logic.js"></script>
  <script src="../generators/python/loops.js"></script>
  <script src="../generators/python/math.js"></script>
  <script src="../generators/python/text.js"></script>
  <script src="../generators/python/lists.js"></script>
  <script src="../generators/python/colour.js"></script>
  <script src="../generators/python/variables.js"></script>
  <script src="../generators/python/variables_dynamic.js"></script>
  <script src="../generators/python/procedures.js"></script>
  <script src="../generators/python/import.js"></script>
  <script src="../msg/messages.js"></script>
  <script src="../blocks/logic.js"></script>
  <script src="../blocks/loops.js"></script>
  <script src="../blocks/math.js"></script>
  <script src="../blocks/text.js"></script>
  <script src="../blocks/lists.js"></script>
  <script src="../blocks/colour.js"></script>
  <script src="../blocks/variables.js"></script>
  <script src="../blocks/variables_dynamic.js"></script>
  <script src="../blocks/procedures.js"></script>
  <script src="../blocks/import.js"></script>
  <script src="src/js/canvas/Canvas.js"></script>


  <script src="../blocks/sprites/motions.js"></script>
  <script src="../blocks/sprites/looks.js"></script>
  <script src="../blocks/sprites/sounds.js"></script>
  <script src="../blocks/sprites/events.js"></script>
  <script src="../blocks/sprites/controls.js"></script>
  <script src="../blocks/sprites/sensing.js"></script>
  <script src="../blocks/sprites/operators.js"></script>
  <script src="../blocks/sprites/variables.js"></script>
  <script src="../generators/javascript/sprites/controls.js"></script>
  <script src="../generators/javascript/sprites/events.js"></script>
  <script src="../generators/javascript/sprites/looks.js"></script>
  <script src="../generators/javascript/sprites/motions.js"></script>
  <script src="../generators/javascript/sprites/operators.js"></script>
  <script src="../generators/javascript/sprites/sensing.js"></script>
  <script src="../generators/javascript/sprites/sounds.js"></script>
  <script src="blocks/test_blocks.js"></script>

  <script src="src/js/sprite_editor/drawengine.js"></script>
  <script src="src/js/sprite_editor/painter.js"></script>

  <link rel="stylesheet" href="src/css/playground_css.css">
  <link rel="stylesheet" href="src/css/fonts.css">
  <link rel="stylesheet" href="src/css/blockly_override.css">
  <link rel="stylesheet" href="src/css/top_menu.css">

  <script src="../JSInterpreter/acorn.js"></script>
  <script src="../JSInterpreter/interpreter.js"></script>

  <script src="../msg/js/ko.js"></script>
  <script src="src/translations/ko.js"></script>

  <script>
    'use strict';

    var blockWorkspace = null;
    var toolbox = null;

    function start() {

      setBackgroundColour();
      // Parse the URL arguments.
      var match = location.search.match(/dir=([^&]+)/);
      var rtl = match && match[1] == 'rtl';
      document.forms.options.elements.dir.selectedIndex = Number(rtl);
      toolbox = getToolboxElement();
      var toolboxNames = [
        'toolbox-categories',
        'toolbox-categories-typed-variables',
        'toolbox-simple',
        'toolbox-test-blocks'
      ];
      document.forms.options.elements.toolbox.selectedIndex =
          toolboxNames.indexOf(toolbox.id);
      match = location.search.match(/side=([^&]+)/);
      var side = match ? match[1] : 'start';
      document.forms.options.elements.side.value = side;
      // Create main workspace.
      blockWorkspace = Blockly.inject('blocklyDiv',
          {
            comments: true,
            collapse: true,
            disable: true,
            grid:
                {
                  spacing: 25,
                  length: 3,
                  colour: '#ccc',
                  snap: true
                },
            horizontalLayout: side == 'top' || side == 'bottom',
            maxBlocks: Infinity,
            maxInstances: {'limit_instances': 3},
            media: '../media/',
            oneBasedIndex: true,
            readOnly: false,
            rtl: rtl,
            scrollbars: true,
            toolbox: toolbox,
            toolboxPosition: side == 'top' || side == 'start' ? 'start' : 'end',
            zoom:
                {
                  controls: true,
                  wheel: true,
                  startScale: 1.0,
                  maxScale: 4,
                  minScale: 0.25,
                  scaleSpeed: 1.1
                }
          });
      // block이 바뀔 때마다 최신코드 생성
      blockWorkspace.addChangeListener(function(event) {
        if (!(event instanceof Blockly.Events.Ui)) {
          // Something changed. Parser needs to be reloaded.
          generateCodeAndLoadIntoInterpreter();
        }
      });
      addToolboxButtonCallbacks();
      // Restore previously displayed text.
      if (sessionStorage) {
        var text = sessionStorage.getItem('textarea');
        if (text) {
          document.getElementById('importExport').value = text;
        }
        // Restore event logging state.
        var state = sessionStorage.getItem('logEvents');
        logEvents(Boolean(Number(state)));
      } else {
        // MSIE 11 does not support sessionStorage on file:// URLs.
        logEvents(false);
      }
      tabInit();
      onLoadPage();
    }

    function addToolboxButtonCallbacks() {
      blockWorkspace.registerButtonCallback(
          'addDynamicOption', Blockly.TestBlocks.addDynamicDropdownOption_);
      blockWorkspace.registerButtonCallback(
          'removeDynamicOption', Blockly.TestBlocks.removeDynamicDropdownOption_);
    }

    function changeTheme() {
      var theme = document.getElementById('themeChanger');
      if (theme.value === "modern") {
        Blockly.setTheme(Blockly.Themes.Modern);
      } else if (theme.value === "high_contrast") {
        Blockly.setTheme(Blockly.Themes.HighContrast);
      } else {
        Blockly.setTheme(Blockly.Themes.Classic);
      }
    }

    function setBackgroundColour() {
      // Set background colour to differentiate server vs local copy.
      if (location.protocol == 'file:') {
        var lilac = '#d6d6ff';
        document.body.style.backgroundColor = lilac;
      }
    }

    function getToolboxElement() {
      var match = location.search.match(/toolbox=([^&]+)/);
      // Default to the basic toolbox with categories and untyped variables,
      // but override that if the toolbox type is set in the URL.
      var toolboxSuffix = (match ? match[1] : 'categories');
      // The three possible values are: "simple", "categories",
      // "categories-typed-variables".
      return document.getElementById('toolbox-' + toolboxSuffix);
    }

    function setSpriteXML() {
      var first_value = Object.keys(myCanvas.sprites)[0];

      var output = document.getElementById('importExport');
      output.value = myCanvas.getSpriteByName(first_value).xml;
      taChange();
    }

    function toXml() {
      let input = document.getElementById("importExport");
      let xml = Blockly.Xml.workspaceToDom(blockWorkspace);
      let xmlText = Blockly.Xml.domToPrettyText(xml);

      input.value = xmlText;
    }

    function fromXml() {
      let input = document.getElementById('importExport');
      let xml = Blockly.Xml.textToDom(libraryManager.libraries["testLibrary"].functions["aFunction"].xml);
      Blockly.Xml.domToWorkspace(xml, blockWorkspace);

      taChange();
    }

    function delayWrapper(keyOfSprite, isClone=false) {
      return new Promise(function (resolve, reject) {
        setTimeout(function (){
          myCanvas.specificSpriteName = keyOfSprite;
          var isFalse = stepCode(keyOfSprite, isClone);
          resolve(isFalse);

        }, 2);
      });
    }

    function re_start(){
        myCanvas.restart();
    }

    // key press event
    document.onkeydown = function(event) {
      switch (event.keyCode) {
        case 37:
          myCanvas.getCurrentSprite().changeDirection(new Degree(180));
          myCanvas.getCurrentSprite().moveSteps(3);

          //alert('Left key pressed');
          break;
        case 38:
          myCanvas.getCurrentSprite().changeDirection(new Degree(270));
          myCanvas.getCurrentSprite().moveSteps(3);

          //alert('Up key pressed');
          break;
        case 39:
          //alert('Right key pressed');
          myCanvas.getCurrentSprite().changeDirection(new Degree(0));
          myCanvas.getCurrentSprite().moveSteps(3);

          break;
        case 40:
          //alert('Down key pressed');
          myCanvas.getCurrentSprite().changeDirection(new Degree(90));
          myCanvas.getCurrentSprite().moveSteps(3);

          break;
      }
    };



    function goStep(){
        if(myCanvas.isHalting)
            re_start();

      for(var i = 1; i < myCanvas.spritesOrder.length; i++){
          if(myCanvas.spritesOrder[i] !== null && !myCanvas.spritesOrder[i].isClone[0])
              _goStep(myCanvas.spritesOrder[i].name) // myCanvas.spritesOrder[i] === Sprite in order
      }
    }

    function _goStep(keyOfSprite, isClone=false){
      if(myCanvas.isHalting){
        return 0;
      }
      delayWrapper(keyOfSprite, isClone)
              .then(
                      function (result) {
                        if(myCanvas.getSpriteByName(keyOfSprite).isHalting)
                          return 0;
                        if(!myCanvas.getSpriteByName(keyOfSprite).isContinue)
                          return 0;
                        if(result !== false)
                          _goStep(keyOfSprite, isClone);
                      }
              );
    }

    function ObjSuspend() {
        myCanvas.allPause();
    }

    // initApi 'createClone' statement wrapper
    function createClone(){
        console.log("create sprite ___ clone")
        var spriteObject = myCanvas.getSpecificSprite();
        var parentName = myCanvas.specificSpriteName;
        var cloneName = getNoDuplicationName(parentName, "_clone");
        spriteObject.cloneChilds = cloneName; // clone 이름을 parent sprite에 저장
        var imageSrc = spriteObject.getImageSource();
        var position = spriteObject.position; // x, y 좌표
        myCanvas.addSpriteAndSelect(cloneName, imageSrc, [true, parentName, position]); // idx4 : isClone or not

      // var libCode = myCanvas.libCode;
      var libCode = libraryManager.getLibraryJsCode();
      if(libCode){
        // libCode = libCode.replace("null", "")
        // libCode = libCode.replace("null", "")
        // libCode = libCode.replace("nullnull", "")

        // latestCodes[keyOfLatestCode] = libCode + latestCodes[keyOfLatestCode];
        let codeWithLib = libCode + myCanvas.getSpriteByName(cloneName).jsCode;
        myCanvas.getSpriteByName(cloneName).jsCode = codeWithLib;
        console.log( myCanvas.getSpriteByName(cloneName).jsCode);
      }
        return cloneName;
    }

    function initApi(interpreter, scope) {
      interpreter.setProperty(scope, 'nextCostume',
          interpreter.createNativeFunction(function() {
            myCanvas.getSpecificSprite().nextCostume();

          }));

      interpreter.setProperty(scope, 'switchCostume',
          interpreter.createNativeFunction(function(spriteNum) {
            myCanvas.getSpecificSprite().switchCostume(spriteNum);

          }));

      interpreter.setProperty(scope, 'touching_edge',
              interpreter.createNativeFunction(function() {
                // 480, 400 : canvas size (hardcoding)
                var pos = myCanvas.getSpecificSprite().position;
                var size = myCanvas.getSpecificSprite().size;
                //console.log(pos.x, pos.y);
                //console.log(size.width, size.height);
                if(pos.x <= 0 || pos.y <= 0){
                  return true;
                }
                if(pos.x  >= 480 - size.width || pos.y >= 400 - size.height){
                  return true;
                }
                return false;
              }));

      interpreter.setProperty(scope, 'allStop',
              interpreter.createNativeFunction(function() {
                myCanvas.allPause();
              }));


      interpreter.setProperty(scope, 'touching_mouse',
              interpreter.createNativeFunction(function() {

              }));

      interpreter.setProperty(scope, 'isTouchingSprite',
              interpreter.createNativeFunction(function(text) {
                let ret = myCanvas.getCurrentSprite().isTouchingSprite(text);
                let childs = myCanvas.getSpriteByName(text).cloneChilds
                for(let i in childs){
                  if(ret) return ret;
                  ret = myCanvas.getCurrentSprite().isTouchingSprite(childs[i]);
                }
                return ret;
                //console.log(myCanvas.getSpriteByName(text).cloneChilds);
                //console.log(myCanvas.getCurrentSprite().isTouchingSprite(text));
              }));

      interpreter.setProperty(scope, 'edgeBounce',
              interpreter.createNativeFunction(function() {

              }));
      interpreter.setProperty(scope, 'turnRight',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().turnRight(new Degree(text));

              }));
      interpreter.setProperty(scope, 'turnLeft',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().turnLeft(new Degree(text));

              }));
      interpreter.setProperty(scope, 'moveSteps',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().moveSteps(parseInt(text));

              }));

      interpreter.setProperty(scope, 'say',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().say(text);
              }));

      interpreter.setProperty(scope, 'setDirection',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().changeDirection(new Degree(text));
              }));

      interpreter.setProperty(scope, 'isTouchingColorHex',
              interpreter.createNativeFunction(function(hexValue) {
                hexValue = hexValue ? hexValue.toString() : '';
                return myCanvas.getSpecificSprite().isTouchingColorHex(hexValue);
              }));

      interpreter.setProperty(scope, 'sprite_getX',
              interpreter.createNativeFunction(function() {
                return myCanvas.getSpecificSprite().x;
              }));

      interpreter.setProperty(scope, 'sprite_getY',
              interpreter.createNativeFunction(function() {
                return myCanvas.getSpecificSprite().y;
              }));

      interpreter.setProperty(scope, 'getMouseY',
              interpreter.createNativeFunction(function() {
                return myCanvas.handler.getMousePosition().y;
              }));

      interpreter.setProperty(scope, 'getMouseX',
              interpreter.createNativeFunction(function() {
                return myCanvas.handler.getMousePosition().x;
              }));


      interpreter.setProperty(scope, 'setXY',
              interpreter.createNativeFunction(function(x, y) {
                //text = text ? text.toString() : '';
                x = parseInt(x);
                y = parseInt(y);
                myCanvas.getSpecificSprite().goToPoint(x, y);
              }));

      // Add an API function for the alert() block, generated for "text_print" blocks.
      interpreter.setProperty(scope, 'alert',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                var output = document.getElementById('importExport');
                output.value += '\n' + text;
              }));
    interpreter.setProperty(scope, 'flagClicked',
        interpreter.createNativeFunction(function(text) {
            //do nothing
        }));
        interpreter.setProperty(scope, 'cloning',
            interpreter.createNativeFunction(function(text) {
                //do nothing
            }));
        interpreter.setProperty(scope, 'createClone',
            interpreter.createNativeFunction(function() {
                //myCanvas.getSpecificSprite();
                var cloneName = createClone();
                // latestCodes[cloneName] = "";
                // myCanvas.getSpriteByName(cloneName).jsCode = "";
                _goStep(cloneName, true);
            }));
        interpreter.setProperty(scope, 'glideToMousePosition',
            interpreter.createNativeFunction(function(second) {
                myCanvas.getSpecificSprite().glideToMousePosition(second);
            }));
      interpreter.setProperty(scope, 'down_arrow',
              interpreter.createNativeFunction(function(second) {
                console.log(event.key);
                if(event.key == "ArrowUp"){
                  return true;
                } else {
                  return false;
                }
              }));

      interpreter.setProperty(scope, 'up_arrow',
              interpreter.createNativeFunction(function(second) {

              }));

      interpreter.setProperty(scope, 'left_arrow',
              interpreter.createNativeFunction(function(second) {

              }));

      interpreter.setProperty(scope, 'right_arrow',
              interpreter.createNativeFunction(function(second) {

              }));


      interpreter.setProperty(scope, 'wait',
            interpreter.createNativeFunction(function(second) {
              var nameOfSprite = myCanvas.specificSpriteName;
              myCanvas.getSpriteByName(nameOfSprite).isContinue = false;
              myCanvas.getSpriteByName(nameOfSprite).wait(second).then(value=>{
                console.log(myCanvas.specificSpriteName)
                myCanvas.getSpriteByName(nameOfSprite).isContinue = true;
                if(!myCanvas.getSpriteByName(nameOfSprite).isHalting);
                  _goStep(nameOfSprite);
              });
            }));


        // Add an API function for the prompt() block.
      var wrapper = function(text) {
        text = text ? text.toString() : '';
        return interpreter.createPrimitive(prompt(text));
      };
      interpreter.setProperty(scope, 'prompt',
              interpreter.createNativeFunction(wrapper));

      // Add an API function for highlighting blocks.
      var wrapper = function(id) {
        id = id ? id.toString() : '';
        return interpreter.createPrimitive(highlightBlock(id));
      };
      interpreter.setProperty(scope, 'highlightBlock',
              interpreter.createNativeFunction(wrapper));
    }

    function highlightBlock(id) {
      blockWorkspace.highlightBlock(id);
      highlightPause = true;
    }

    function resetStepUi(clearOutput) {
      blockWorkspace.highlightBlock(null);
      highlightPause = false;

      if (clearOutput) {
        var output = document.getElementById('importExport');
        output.value = 'Program output:\n=================';
      }
    }

    var myInterpreters = {};
    var highlightPause = false;
    // var latestCodes = {};

    /* event block 코드를 최신 코드에서 가져와 현재 Sprite 객체에 배치한다. */
    function eventCodeHandling(code){
      console.log(code);
        var tmp = code.split("\n\n"); // event parser;
        var ret = ""
        // 각 이벤트 클리어
        myCanvas.getCurrentSprite()._whenClicked = [];
        myCanvas.getCurrentSprite()._whenCloning = [];
        for(var a in tmp){
            if(tmp[a].search("flagClicked") != -1){
                myCanvas.getCurrentSprite()._whenClicked.push(tmp[a]);
            } else if(tmp[a].search("cloning") != -1) {
                myCanvas.getCurrentSprite()._whenCloning.push(tmp[a]);
            }else {
                ret += tmp[a] + "\n\n"
            }
        }
        return ret;
    }

    function generateCodeAndLoadIntoInterpreter() {
      // Generate JavaScript code and parse it.
      Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\n';
      Blockly.JavaScript.addReservedWords('highlightBlock');
      let keyOfLatestCode = myCanvas.currentSpriteName;
      // latestCodes[keyOfLatestCode] = Blockly["JavaScript"].workspaceToCode(blockWorkspace);
      myCanvas.getSpriteByName(keyOfLatestCode).jsCode = Blockly["JavaScript"].workspaceToCode(
          blockWorkspace);

      // eventCode 현재 Sprite 객체에 배치, 이벤트 코드를 제외한 최신 코드 초기화
      // latestCodes[keyOfLatestCode] = eventCodeHandling(latestCodes[keyOfLatestCode]);
      let eventCode = eventCodeHandling(myCanvas.getSpriteByName(keyOfLatestCode).jsCode);
      myCanvas.getSpriteByName(keyOfLatestCode).jsCode = eventCode;

      // var libCode = myCanvas.libCode;
      var libCode = libraryManager.getLibraryJsCode();
      if(libCode){
        // libCode = libCode.replace("null", "")
        // libCode = libCode.replace("null", "")
        // libCode = libCode.replace("nullnull", "")

        // latestCodes[keyOfLatestCode] = libCode + latestCodes[keyOfLatestCode]  ;
        let codeWithLib = libCode + myCanvas.getSpriteByName(keyOfLatestCode).jsCode;
        myCanvas.getSpriteByName(keyOfLatestCode).jsCode = codeWithLib;
      }
      // latestCodes[keyOfLatestCode] = latestCodes[keyOfLatestCode].replace("nullnull", "");
      let codeWithoutNull = myCanvas.getSpriteByName(keyOfLatestCode).jsCode.replace("nullnull", "");
      myCanvas.getSpriteByName(keyOfLatestCode).jsCode = codeWithoutNull;

      console.log(myCanvas.getSpriteByName(keyOfLatestCode).jsCode);

      // step execution 용 코드
      if(!myInterpreters[myCanvas.currentSpriteName])
        //console.log("soicem");
      for(var i = 1; i < myCanvas.spritesOrder.length; i++){
        //console.log(myCanvas.spritesOrder[i].getImageFilename());
      }
    }

    // event block을 참조하여 Interpreter에 들어가는 target code생성
    function createTargetCode(keyOfSprite, isClone){
        var tmp = "";
        if(isClone){
            var parentName = myCanvas.getSpriteByName(keyOfSprite).isClone[1];
            tmp = myCanvas.getSpriteByName(parentName)._whenCloning;
        } else {
            tmp = myCanvas.getSpriteByName(keyOfSprite)._whenClicked;
        }
        // var ret = latestCodes[keyOfSprite];
        var ret = myCanvas.getSpriteByName(keyOfSprite).jsCode;
        for(var a in tmp){
            ret += tmp[a] + "\n\n";
        }
        return ret;
    }

    function stepCode(keyOfSprite, isClone=false) {
      var keyOfCode = keyOfSprite;
      if (!myInterpreters[keyOfCode]) {
        // First statement of this code.
        // Clear the program output.
        resetStepUi(true);
          // latestcodes에는 event Code를 제외한 메인 코드가 초기화되어있음
        // latestCodes[keyOfCode] = latestCodes[keyOfCode].replace("nullnull", "");
        let codeWithoutNull = myCanvas.getSpriteByName(keyOfCode).jsCode.replace("nullnull", "");
        myCanvas.getSpriteByName(keyOfCode).jsCode = codeWithoutNull;
        var targetCode = "";
        targetCode = createTargetCode(keyOfCode, isClone);
        //console.log("stepCode", keyOfCode, targetCode);
        myInterpreters[keyOfCode] = new Interpreter(targetCode, initApi);
        return;
      }
      highlightPause = false;

      do {
        try {
          var hasMoreCode = myInterpreters[keyOfCode].step();
        } finally {
          if (!hasMoreCode) {
            // Program complete, no more code to execute.
            var output = document.getElementById('importExport');
            output.value += '\n\n<< Program complete >>';

            myInterpreters[keyOfCode] = null;
            resetStepUi(false);

            // Cool down, to discourage accidentally restarting the program.
            //stepButton.disabled = 'disabled';
            return false;
          }
        }
        // Keep executing until a highlight statement is reached,
        // or the code completes or errors.
      } while (hasMoreCode && !highlightPause);

    }

    // Load the interpreter now, and upon future changes.
    //generateCodeAndLoadIntoInterpreter();


    // block을 Javascript 코드로 변환하고, 이를 실행시킨다.
    function toJSCode() {
      let output = document.getElementById('importExport');
      output.value = Blockly["JavaScript"].workspaceToCode(blockWorkspace);
      //canvas.clear();
      //alert(output.value);
      //objectsOfSprites[currentSprite].jsCode = output.value;
      myCanvas.getCurrentSprite().printProperties();
      // objectsOfSprites[currentSprite].printProperties();
      myCanvas.getCurrentSprite().executeJS(output.value);
      // objectsOfSprites[currentSprite].executeJS(output.value);
      //console.log(objectsOfSprites[currentSprite].jsCode);
      //objectsOfSprites[currentSprite].printProperties()
      //objectsOfSprites[currentSprite].draw();
      console.log(myCanvas.getCurrentSprite());
    }

    function toCodeMain() {
      //var lang = document.getElementById('mainLang');
      output.value = Blockly["Python"].workspaceToCode(blockWorkspace);
      var libFunction = samplePy();
      var pyCode = output.value;
      pyCode = "from testFunction import *\n" + pyCode;
      var libraries = {
        'numberOfLibs': 1, 'libraryInfo': {
          0: {"name": "testFunction", "body": libFunction}
        }
      };
      console.log(pyCode);
      console.log(libFunction);

      sendAjax('http://127.0.0.1:3000/ajax_send_email', pyCode, libraries);
      taChange();
    }

    function toCodeLib() {
      var lang = document.getElementById('libLang');
      output.value = Blockly[lang.value].workspaceToCode(libraryspace);
      var libFunction = samplePy();
      var pyCode = output.value;
      pyCode = "from testFunction import *\n" + pyCode;
      var libraries = {
        'numberOfLibs': 1, 'libraryInfo': {
          0: {"name": "testFunction", "body": libFunction}
        }
      };
      console.log(pyCode);
      console.log(libFunction);

      sendAjax('http://127.0.0.1:3000/ajax_send_email', pyCode, libraries);
      taChange();
    }

    // Disable the "Import from XML" button if the XML is invalid.
    // Preserve text between page reloads.
    function taChange() {
      var textarea = document.getElementById('importExport');
      if (sessionStorage) {
        sessionStorage.setItem('textarea', textarea.value);
      }
      var valid = true;
      try {
        Blockly.Xml.textToDom(textarea.value);
      } catch (e) {
        valid = false;
      }
      //document.getElementById('importExport').disabled = !valid;
    }

    function logEvents(state) {
      var checkbox = document.getElementById('logCheck');
      checkbox.checked = state;
      if (sessionStorage) {
        sessionStorage.setItem('logEvents', Number(state));
      }
      if (state) {
        blockWorkspace.addChangeListener(logger);
      } else {
        blockWorkspace.removeChangeListener(logger);
      }
    }

    function logger(e) {
      console.log(e);
    }

    function tabInit() {
      showTab('blocklyDiv', 'main_tab');
      //hideTab('library', 'library_tab');
      hideTab('sprite', 'sprite_tab');
    }

    function changeTab(tab) {
      if (tab.id === "main_tab") {
        showTab('blocklyDiv', 'main_tab');
        //hideTab('library', 'library_tab');
        hideTab('sprite', 'sprite_tab');
      } else if (tab.id === "library_tab") {
        //showTab('library', 'library_tab');
        hideTab('blocklyDiv', 'main_tab');
        hideTab('sprite', 'sprite_tab')
      } else if (tab.id === "sprite_tab") {
        showTab('sprite', 'sprite_tab');
        //hideTab('library', 'library_tab');
        hideTab('blocklyDiv', 'main_tab');
      }
    }

    function hideTab(page, tab) {
      document.getElementById(page).style.display = 'none';
      document.getElementById(tab).parentNode.style.backgroundColor = 'white';
      document.getElementById(tab).parentNode.style.color = 'black';
    }

    function showTab(page, tab) {
      document.getElementById(page).style.display = 'block';
      document.getElementById(tab).parentNode.style.backgroundColor = '#4996ff';
      document.getElementById(tab).parentNode.style.color = 'white';
    }

    function loadImage(src){
      var imgClo = new Image();
      imgClo.addEventListener('load', function(){
        var ctx = document.getElementById('spriteCanvas').getContext("2d");
        ctx.drawImage(imgClo , 200, 200, 100, 100);
      },false);
      imgClo.src = src;
    }

    function myStart() {
      toolboxManager = ToolboxManager.createWithDom(blockWorkspace, document.getElementById("toolbox-categories"));
      libraryManager = new LibraryManager(toolboxManager);
      animationUpdater = new AnimationUpdater();
      myCanvas = new Canvas(document.getElementById("canvas"), new Size(480, 400), blockWorkspace);

      myCanvas.addSpriteAndSelect("penguin", "penguin.png");
      TrashToImg("penguin");
      animationUpdater.addCallFunction({caller: myCanvas, method: myCanvas.render});
      animationUpdater.start();
    }
  </script>

  <script src="src/js/import/blk.js"></script>
  <script src="src/js/import/library.js"></script>
  <script src="src/js/export/blk.js"></script>
  <script src="src/js/copy_paste/copypaste.js"></script>

</head>
<body onload="start(); myStart();">

<div id="topMenu">
  <div id="topMenuLogo" class="topMenu_left">
    <img id="topMenuLogo_image" class="topMenu_left" src="src/resources/images/Flippers-Animation.gif">
  </div>
  <div id="topMenuList" class="topMenu_left">
    <ul class="topMenu_left cursorPointer hoverTextShadow">
      <li class="topMenu_left">
        <span class="verticalMidPointBase"></span>
        <span id="main_tab" class="verticallyMiddle horizontalGap" onclick="changeTab(this)">Main</span>
      </li>
      <li class="topMenu_left">
        <span class="verticalMidPointBase"></span>
        <span id="sprite_tab" class="verticallyMiddle horizontalGap" onclick="changeTab(this)">Sprite</span>
      </li>
    </ul>
  </div>
  <div class="topMenu_right">
    <span class="verticalMidPointBase"></span>
    <img class="verticallyMiddle cursorPointer" onclick="ObjSuspend()" src="src/resources/images/Stop-Button.PNG" style="padding: 10px; height: 60%; vertical-align: middle">
  </div>

  <div id="topMenuControl" class="topMenu_right">
    <span class="verticalMidPointBase"></span>
    <img class="verticallyMiddle cursorPointer" onclick="goStep()" src="src/resources/images/Play-Button.png" style="padding: 10px; height: 60%; vertical-align: middle">
  </div>

</div>

<div id="bodyContent">

  <!---- Main Tab ----->
  <div id="blocklyDiv"></div>
  <!--- Library Tab --->
<!--  <div id="library">-->
<!--    <div id="librarySpace"></div>-->
<!--    <p>-->
<!--      <select id="libLang" name="lang" onchange="toCodeLib()">-->
<!--        <option value="default">Select</option>-->
<!--        <option value="JavaScript">JavaScript</option>-->
<!--        <option value="Python">Python</option>-->
<!--        <option value="PHP">PHP</option>-->
<!--        <option value="Lua">Lua</option>-->
<!--        <option value="Dart">Dart</option>-->
<!--      </select>-->
<!--      <br>-->
<!--      <textarea id="importExport_" style="width: 90%; height: 70%;"-->
<!--                onchange="taChange();" onkeyup="taChange()">-->
<!--    </textarea>-->
<!--    </p>-->
<!--  </div>-->
  <!--- Sprite Tab ---->
  <div id="sprite">
    <script>
      function costumeChooser() {
        var path = "";
        var name;
        var x = document.getElementById("costumeChooser");
        var txt = "";
        var imageFile = x.files[0];
        var reader = new FileReader();
        var spriteObject = myCanvas.getCurrentSprite();

        if ('files' in x) {
          if (x.files.length === 0) {
            txt = "Select one or more files.";
          } else {
            for (var i = 0; i < x.files.length; i++) {
              txt += "<br><strong>" + (i + 1) + ". file</strong><br>";
              var file = x.files[i];
              if ('name' in file) {
                txt += "name: " + file.name + "<br>";
                name = file.name;
              }
              if ('size' in file) {
                txt += "size: " + file.size + " bytes <br>";
              }
              if ('value' in file) {
                txt += "value: " + file.value + " bytes <br>";
              }
            }
          }
        } else {
          if (x.value === "") {
            txt += "Select one or more files.";
          } else {
            txt += "The files property is not supported by your browser!";
            txt += "<br>The path of the selected file: " + x.value;
          }
        }

        var costumeNum = myCanvas.getCurrentSprite().getCostumeLength();
        var spriteName = getNoDuplicationName(name); // Sprite name 중복 제거
        var a = '<div class="costumeImg\" id="' + myCanvas.currentSpriteName + '_' + costumeNum + '" onclick="myCanvas.setCurrentCostume('
                + costumeNum + ')">'
                + '<img src="' + path + name + '" alt="">'
                + '<div class="desc">' + myCanvas.currentSpriteName + '_' + costumeNum + '</div>'
                + '<img src="./src/resources/images/trash.png" class="trash" onclick="myCanvas.deleteCostumeAndSelect('+ costumeNum +')">'
                + '</div>';
        document.getElementById("costumeGallery").innerHTML += a;
        initPage();
        reader.addEventListener('load', function () {
          myCanvas.addCostumeAndSelect(name);
        });
        //loadImage(path + name);
        if (imageFile) {
          reader.readAsArrayBuffer(imageFile);
        }
        document.getElementById("costumeChooser").value = "";
      }

    </script>
    <div id="spriteImageGallery_container" class="rounded">
      <div id="spriteImageGallery">
        <div id="costumeGallery">
          <div class="costumeImg" id="penguin_0"
               onclick="myCanvas.setCurrentCostume(0)">
            <img src="penguin.png" alt="">
            <div class="desc">penguin_0</div>
          </div>
        </div>
        <div class="plusButton spritePlus">
          <span class="plus">
            <input type="file" id="costumeChooser" accept="image/*" multiple size="50"
                   onchange="costumeChooser()">
          </span>
        </div>
      </div>
    </div>
    <div id="CanvasAndPainter_container">
      <div id="spriteCanvas_wrapper" class="rounded">
        <div id="spriteCanvas_container">
          <canvas id="spriteCanvas"></canvas>
        </div>
        <span class="cell">
<!--              <INPUT type="file" id="load_filename" value="Load" onChange="loadFile()" />-->
              <div>
                <a id="saveImage" download="image.png">
                    <INPUT type="button" value="Save" onClick="saveImage(myCanvas.currentSpriteName + '_' + myCanvas.currentCostumeNum)" />
                </a>
                <INPUT type="button" value="Clear" onClick="initPage()" />
              </div>
<!--              <div>-->
<!--                <INPUT type="button" value="Clear Gallery" onClick="clearCostumeGallery()" />-->
<!--              </div>-->
<!--              <div>-->
<!--                <input type="button" value="Save as Txt" onClick="SaveAsTxt()" />-->
<!--              </div>-->
              <div>
                <textarea id="history" cols="40" rows="37" style="display: none;"></textarea>
              </div>
              <div id="command">
              </div>
<!--              <INPUT type="button" value="Redraw" onClick="reDrawCanvas()" />-->
            </span>
      </div>
      <script>

        var textareaList = ["history"];

        function clearText(idOfTextArea) {
          document.getElementById(idOfTextArea).value = "";
        }

        function SaveAsTxt() {
          var fileName = document.getElementById("title").value;
          if (fileName.length == 0) {
            fileName = "image";
          }
          fileName += ".txt";

          var preData = 'version: V0.617a1\n';
          var postData =  preData + document.getElementById("history").value;

          var link = document.createElement("a");
          link.setAttribute("download", fileName);
          link.setAttribute(
                  "href",
                  "data:" +
                  "application/[txt]" +
                  ";charset=utf-8," +
                  encodeURIComponent(postData)
          );
          link.click();
        }

        function isJsonFile(filename) {
          var ridx = filename.lastIndexOf(".");
          var extension = filename.substring(ridx + 1);

          console.log(extension);

          if (extension.length != 4 || extension.toLowerCase() != "json") {
            return false;
          }
          return true;
        }

        function isTextFile(filename) {
          var ridx = filename.lastIndexOf(".");
          var extension = filename.substring(ridx + 1);

          console.log(extension);

          if (extension.length != 3 || extension.toLowerCase() != "txt") {
            return false;
          }
          return true;
        }


        function loadFile() {
          var loadFile = document.getElementById("load_filename");
          var file = loadFile.files[0];

          if (!file) {
            return;
          }

          var fileName = document.getElementById("load_filename").value;
          var ridx = fileName.lastIndexOf("\\");

          fileName = fileName.substring(ridx + 1);

          if (isJsonFile(fileName)) {
            LoadJson(file, fileName);
          } else if(isTextFile(fileName)) {
            LoadText(file, fileName);
          }
        }

        function LoadJson(file, fileName) {
          document.getElementById("title").value = fileName;

          var reader = new FileReader();
          reader.onload = function(e) {
            var contents = e.target.result;
            displayLoadJsonData(contents);
          };
          reader.readAsText(file);
        }

        function displayLoadJsonData(contents) {
          var noteData = JSON.parse(contents);

          var version = noteData['version'];
          console.log(version);
          document.getElementById('history').value = noteData['history'];
          reDrawCanvas();
        }

        function LoadText(file, fileName) {
          document.getElementById("title").value = fileName;

          var reader = new FileReader();
          reader.onload = function(e) {
            var contents = e.target.result;
            displayLoadTextData(contents);
          };
          reader.readAsText(file);
        }

        function displayLoadTextData(contents) {
          var noteData = contents.split('\n');
          var history = "";

          noteData.forEach(function (e){
            if (e[0] != 'v') {
              history += e + "\n";
            }
          });
          document.getElementById('history').value = history;
          reDrawCanvas();
        }
      </script>
      <div id="palette" class="rounded">
          <div class="row">
            <span class="cell" width="82">
              <div class="jb_table">
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/red.png" onclick="selectColor('red')" />
                    <img src="src/resources/images/paint_editor/orange.png" onclick="selectColor('orange')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/yellow.png" onclick="selectColor('yellow')" />
                    <img src="src/resources/images/paint_editor/green.png" onclick="selectColor('green')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor//blue.png" onclick="selectColor('blue')" />
                    <img src="src/resources/images/paint_editor/lightblue.png" onclick="selectColor('lightblue')" />
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/lightgreen.png" onclick="selectColor('lightgreen')"/>
                    <img src="src/resources/images/paint_editor/brown.png" onclick="selectColor('brown')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/purple.png" onclick="selectColor('purple')" />
                    <img src="src/resources/images/paint_editor/pink.png" onclick="selectColor('pink')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/gray.png" onclick="selectColor('gray')" />
                    <img src="src/resources/images/paint_editor/lightgray.png" onclick="selectColor('lightgray')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/black.png" onclick="selectColor('black')"/>
                    <img src="src/resources/images/paint_editor/white.png" onclick="selectColor('white')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/pencil.png"  onclick="selectTool('pencil')" />
                    <img src="src/resources/images/paint_editor/line.png"  onclick="selectTool('line')" />
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/circle.png" onclick="selectTool('circle')"/>
                    <img src="src/resources/images/paint_editor/filledcircle.png" onclick="selectTool('filledcircle')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/square.png" onclick="selectTool('square')"/>
                    <img src="src/resources/images/paint_editor/filledsquare.png" onclick="selectTool('filledsquare')"/>
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/rect.png" onclick="selectTool('rect')" />
                    <img src="src/resources/images/paint_editor/filledrect.png" onclick="selectTool('filledrect')" />
                  </span>
                </div>
                <div class="row">
                  <span class="cell">
                    <img src="src/resources/images/paint_editor/triangle.png" onclick="selectTool('tri')" />
                    <img src="src/resources/images/paint_editor/filledtriangle.png" onclick="selectTool('filledtri')" />
                  </span>
                </div>
                <div class="row">
                    <span class="cell">
                      <img src="src/resources/images/paint_editor/undo.png" onclick="undo()"/>
                      <img src="src/resources/images/paint_editor/redo.png" onclick="redo()"/>
                    </span>
                  </div>
              </div>
            </span>
          </div>
      </div>
      <script src="painter.js"></script>
      <script src="drawengine.js"></script>

    </div>
  </div>
  <!----- Content ----->
  <div id="content">
    <div id="canvasArea" class="rounded gap_at_end">
      <div id="canvasBlock">
        <div id="canvases">
          <canvas id="canvas"></canvas>
        </div>
        <script src="src/js/utils/GalleryUtil.js"></script>
        <script src="src/js/utils/String.js"></script>
        <script src="src/js/encryption/Encryption.js"></script>
        <script src="src/js/animation/AnimationUpdater.js"></script>
        <script src="src/js/canvas/CanvasHandler.js"></script>
        <script src="src/js/canvas/CanvasUtil.js"></script>
        <script src="src/js/canvas/Sprite.js"></script>
        <script src="src/js/canvas/SpriteFactory.js"></script>
        <script src="src/js/canvas/SpeechBubble.js"></script>
        <script src="src/js/toolbox/ToolboxManager.js"></script>
        <script src="src/js/library/Library.js"></script>
        <script src="src/js/library/LibraryBuilder.js"></script>
        <script src="src/js/library/LibraryInfo.js"></script>
        <script src="src/js/library/LibraryManager.js"></script>
        <script src="src/js/library/LibraryUtils.js"></script>
        <script src="src/js/library/JsObjectTemplate.js"></script>
        <script src="src/js/math/Point.js"></script>
        <script src="src/js/math/Size.js"></script>
        <script src="src/js/math/Angle.js"></script>
        <script src="src/js/math/Degree.js"></script>
        <script src="src/js/math/Radian.js"></script>
        <script src="src/js/exception/MyException.js"></script>
        <script src="src/js/exception/SpriteException.js"></script>

        <script>
          /**
           * @type {ToolboxManager}
           */
          let toolboxManager;
          /**
           * @type {LibraryManager}
           */
          let libraryManager;
          /**
           * @type {AnimationUpdater}
           */
          let animationUpdater;
          /**
           * @type {Canvas}
           */
          let myCanvas;

          // Sprite Name 중복 제거 ex) penguin -> penguin1
          function getNoDuplicationName(name, isClone = "") {
            var noDuplicated = 1;
            var spriteName = name.split('.')[0] + isClone;
            var originalName = spriteName;
            var ext = name.split('.')[1];
            while (myCanvas._sprites.hasOwnProperty(spriteName)) {
              spriteName = originalName + noDuplicated;
              noDuplicated += 1;
            }
            return spriteName;
          }

          function removeConfirmation(spriteName) {
            if (confirm("'" + spriteName + "'를 삭제하길 원하십니까?")) {
              myCanvas.removeFromCanvas(spriteName);
            }
          }

          function TrashToImg(name){ // name == parent name. == sprite name
          console.log(name);
              var ImgTrash = document.createElement('img');

              ImgTrash.src = './src/resources/images/trash.png';

              ImgTrash.setAttribute('class', 'trash');
              ImgTrash.setAttribute('onClick', `removeConfirmation("${name}")`);

              var parent = document.getElementById(name);
              parent.appendChild(ImgTrash);
          }

          function readLibraryHeader() {
            let importHeaders = blockWorkspace.getBlocksByType("import_header");

            function addImportStatementLibrary(importStatement) {
              const url = importStatement.getFieldValue("URL");
              console.log(url);
              libraryManager.addLibraryFromUrl(url);

              if (importStatement.childBlocks_[0]) {
                addImportStatementLibrary(importStatement.childBlocks_[0]);
              }
            }

            for (let i = 0; i < importHeaders.length; i++) {
              const importHeader = importHeaders[i];
              const importStatement = importHeader.childBlocks_[0];
              addImportStatementLibrary(importStatement);
            }
          }
        </script>
      </div>
    </div>

    <div id="gallery_owner" class="gap_at_end">
      <div id="sprite_owner" class="rounded">
        <div id="spriteAttributes">
          <ul1>
            <li1> X <input type="text" id="sprite_X"
                           onchange="myCanvas.getCurrentSprite().x = parseInt(document.getElementById('sprite_X').value, 10)">
            </li1>
            <li1> Y <input type="text" id="sprite_Y"
                           onchange="myCanvas.getCurrentSprite().y = parseInt(document.getElementById('sprite_Y').value, 10)">
            </li1>
          </ul1>
          <ul1>
            <li1> Width <input type="text" id="sprite_W"
                               onchange="myCanvas.getCurrentSprite().width = parseInt(document.getElementById('sprite_W').value, 10)">
            </li1>
            <li1> Height <input type="text" id="sprite_H"
                                onchange="myCanvas.getCurrentSprite().height = parseInt(document.getElementById('sprite_H').value, 10)">
            </li1>
          </ul1>
        </div>
        <div id="spriteGallery">
          <div class="plusButton spritePlus">
          <span class="plus">
            <input type="file" id="spriteChooser" accept="image/*" multiple size="50"
                   onchange="GalleryUtil.spriteChooser(this)">
          </span>
          </div>
          <div class="spriteImg" id="penguin"
               onclick="myCanvas.setCurrentSprite('penguin')">
            <img src="penguin.png" alt="">
            <div class="desc">penguin</div>
          </div>
        </div>

      </div>
      <div id="stage_owner" class="rounded">
        <div id="stageGallery">
          <div class="plusButton stagePlus">
          <span class="plus">
            <input type="file" id="stageChooser" accept="image/*" size="50"
                   onchange="GalleryUtil.stageChooser(this)">
          </span>
          </div>
        </div>
      </div>
    </div>



    <div>
      <form id="options" style="display: none">
        <select name="dir" onchange="document.forms.options.submit()">
          <option value="ltr">LTR</option>
          <option value="rtl">RTL</option>
        </select>
        <select name="toolbox" onchange="document.forms.options.submit()">
          <option value="categories">Categories (untyped variables)</option>
          <option value="categories-typed-variables">Categories (typed variables)</option>
          <option value="simple">Simple</option>
          <option value="test-blocks">Test Blocks</option>
        </select>
        <select name="side" onchange="document.forms.options.submit()">
          <option value="start">Start</option>
          <option value="end">End</option>
          <option value="top">Top</option>
          <option value="bottom">Bottom</option>
        </select>
      </form>
      <select id="themeChanger" name="theme" onchange="changeTheme()" style="display:none">
        <option value="classic">Classic</option>
        <option value="modern">Modern</option>
        <option value="high_contrast">High Contrast</option>
      </select>
      <div id="buttonCollection" class="rounded">
        <ul>
          <li2><a id="proj" onclick="exportProjFile('Test', this.id, blockWorkspace)">Export Project</a></li2>
          <li2>
            <a>
              <div class="fileBox">
                <label for="getFile">Import Project</label>
                <input type="file" value="add File" name="files[]" id="getFile"
                       onchange="importProjFile(this, blockWorkspace)"
                       accept=".proj, .zip">
              </div>
            </a>
          </li2>
        </ul>
        <ul>
          <li2><a id="blk" onclick="libraryManager.createLibraryFile(blockWorkspace, 'MyLibrary', 'CSK')">Export Library</a></li2>
          <li2>
            <a>
              <div class="fileBox">
                <label for="getLib">Import Library</label>
                <input type="file" value="add File" name="files[]" id="getLib"
                       onchange="libraryManager.addLibraryFromUrl(this.files[0].name);"
                       accept=".blk, .json">
              </div>
            </a>
          </li2>
        </ul>
        <ul>
          <li2><a id="toJavaScript" onclick="goStep()">To JavaScript</a></li2>
          <li2><a id="toCode" onclick="toCodeMain()">To Python</a></li2>
        </ul>

        <ul>
          <li2><a id="exportXML" onclick="toXml()">Export to XML</a></li2>
          <li2><a id="importXML" onclick="fromXml()">Import from XML</a></li2>
        </ul>

        <ul>
          <li2 style="width: 100%">
            <a id="readLibraryHeader" onclick="readLibraryHeader()">Read library header</a>
          </li2>
        </ul>

        <textarea id="importExport" style="width: calc(100% - 5px); height: 60%"
                  onchange="taChange();" onkeyup="taChange()"></textarea>
      </div>
      <!--
          <p>
            Stress test: &nbsp;
            <input type="button" value="Airstrike!" onclick="airstrike(100)">
            <input type="button" value="Spaghetti!" onclick="spaghetti(8)">
          </p>
      -->
      <p>
        <!--Log events: &nbsp;-->
        <input type="checkbox" onclick="logEvents(this.checked)" id="logCheck" style="display:none">
      </p>
      <!-- The next three blocks of XML are sample toolboxes for testing basic
      configurations.  For more information on building toolboxes, see https://developers.google.com/blockly/guides/configure/web/toolbox -->

      <!-- toolbox-simple is an always-open flyout with no category menu.
      Always-open flyouts are a good idea if you have a small number of blocks. -->
      <xml id="toolbox-simple" style="display: none">
        <block type="controls_ifelse"></block>
        <block type="logic_compare"></block>
        <!-- <block type="control_repeat"></block> -->
        <block type="logic_operation"></block>
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null" disabled="true"></block>
        <block type="logic_ternary"></block>
        <block type="text_charAt">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
        </block>
      </xml>

      <!-- toolbox-categories has a category menu and an auto-closing flyout.  The
      Variables category uses untyped variable blocks.
      See https://developers.google.com/blockly/guides/create-custom-blocks/variables#untyped_variable_blocks for more information. -->
      <xml id="toolbox-categories" style="display: none">
        <category name="Logic" style="logic_category">
          <block type="controls_if"></block>
          <block type="logic_compare"></block>
          <block type="logic_operation"></block>
          <block type="logic_negate"></block>
          <block type="logic_boolean"></block>
          <block type="logic_null" disabled="true"></block>
          <block type="logic_ternary"></block>
        </category>
        <category name="Loops" style="loop_category">
          <block type="controls_repeat_ext">
            <value name="TIMES">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="controls_repeat" disabled="true"></block>
          <block type="controls_whileUntil"></block>
          <block type="controls_for">
            <value name="FROM">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="TO">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
            <value name="BY">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
          <block type="controls_forEach"></block>
          <block type="controls_flow_statements"></block>
        </category>
        <category name="Math" style="math_category">
          <block type="math_number" gap="32">
            <field name="NUM">123</field>
          </block>
          <block type="math_arithmetic">
            <value name="A">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="B">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
          <block type="math_single">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">9</field>
              </shadow>
            </value>
          </block>
          <block type="math_trig">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">45</field>
              </shadow>
            </value>
          </block>
          <block type="math_constant"></block>
          <block type="math_number_property">
            <value name="NUMBER_TO_CHECK">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="math_round">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">3.1</field>
              </shadow>
            </value>
          </block>
          <block type="math_on_list"></block>
          <block type="math_modulo">
            <value name="DIVIDEND">
              <shadow type="math_number">
                <field name="NUM">64</field>
              </shadow>
            </value>
            <value name="DIVISOR">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="math_constrain">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">50</field>
              </shadow>
            </value>
            <value name="LOW">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="HIGH">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
          </block>
          <block type="math_random_int">
            <value name="FROM">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="TO">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
          </block>
          <block type="math_random_float"></block>
          <block type="math_atan2">
            <value name="X">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="Y">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
        </category>

        <category name="Import" colour="#e3ac00">
<!--          <block type="import_return"></block>-->
<!--          <block type="import_noReturn"></block>-->
          <block type="import_header"></block>
          <block type="import_statement">
            <mutation lib="MyLibrary" src="MyLibrary.blk" readOnly="true"></mutation>
          </block>
          <block type="import_statement">
            <mutation lib="MyLibrary" src="https://raw.githubusercontent.com/peurocs4/FlippersLibrary/master/MyLibrary.blk"></mutation>
          </block>
          <!--<block type="import_noReturn" id="123">
            <mutation func="Statement Function" args="2">
              <arg name="argA"/>
              <arg name="argB"/>
            </mutation>
          </block>-->
        </category>

        <category name="Sprite" colour="#0000ff" expanded="true">
          <label text="Motion"></label>
          <block type="sprite_moveSteps">
            <value name="STEPS">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_turnAngle">
            <value name="DEGREE">
              <shadow type="math_number">
                <field name="NUM">15</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_goTo"></block>
          <block type="sprite_goToPoint">
            <value name="X">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
            <value name="Y">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_glideTo">
            <value name="SEC">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_glideToPoint">
            <value name="SEC">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="X">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
            <value name="Y">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_pointTo">
            <value name="DIR">
              <shadow type="math_number">
                <field name="NUM">90</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_pointToward"></block>
          <block type="sprite_changeXY">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_setXY">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_edgeBounce"></block>
          <block type="sprite_rotationStyle"></block>
          <block type="sprite_getXY"></block>
          <block type="sprite_getDir"></block>

          <label text="Looks"></label>
          <block type="sprite_say">
            <value name="CONTENT">
              <shadow type="text">
                <field name="TEXT">Hello World!</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_sayTill">
            <value name="CONTENT">
              <shadow type="text">
                <field name="TEXT">Hello World!</field>
              </shadow>
            </value>
            <value name="SEC">
              <shadow type="math_number">
                <field name="NUM">2</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_think">
            <value name="CONTENT">
              <shadow type="text">
                <field name="TEXT">Hmm...</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_thinkTill">
            <value name="CONTENT">
              <shadow type="text">
                <field name="TEXT">Hmm...</field>
              </shadow>
            </value>
            <value name="SEC">
              <shadow type="math_number">
                <field name="NUM">2</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_nextCostume"></block>
          <block type="sprite_switchCostume"></block>
          <block type="sprite_nextBackdrop"></block>
          <block type="sprite_switchBackdrop"></block>
          <block type="sprite_changeSize">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_setSize">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_changeEffect">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">25</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_setEffect">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_clearEffect"></block>
          <block type="sprite_show"></block>
          <block type="sprite_hide"></block>
          <block type="sprite_setLayer"></block>
          <block type="sprite_changeLayer">
            <value name="COUNT">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_getCostume"></block>
          <block type="sprite_getBackdrop"></block>
          <block type="sprite_getSize"></block>

          <label text="Sounds"></label>
          <block type="sprite_playSound"></block>
          <block type="sprite_startSound"></block>
          <block type="sprite_stopSound"></block>
          <block type="sprite_changeSoundEffect">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_setSoundEffect">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_clearSoundEffect"></block>
          <block type="sprite_changeVolume">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">-10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_setVolume">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_getVolume"></block>

          <label text="Events"></label>
          <block type="sprite_flagClicked"></block>
          <block type="sprite_keyPressed">
            <field name="KEY">space</field>
          </block>
          <block type="sprite_spriteClicked"></block>
          <block type="sprite_backdropSwitched"></block>
          <block type="sprite_loudnessCondition">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_timerCondition">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_messageReceived"></block>
          <block type="sprite_messageBroadcast"></block>
          <block type="sprite_messageBroadcastWait"></block>

          <label text="Controls"></label>
          <block type="sprite_wait">
            <value name="SEC">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_repeat">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">3</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_forever"></block>
          <block type="sprite_if"></block>
          <block type="sprite_ifElse"></block>
          <block type="sprite_waitTill"></block>
          <block type="sprite_repeatTill"></block>
          <block type="sprite_stop"></block>
          <block type="sprite_cloneStarted"></block>
          <block type="sprite_createClone"></block>
          <block type="sprite_deleteClone"></block>

          <label text="Sensing"></label>
          <block type="sprite_touching"></block>
          <block type="sprite_touchingColor"></block>
          <block type="sprite_colorTouchingColor"></block>
          <block type="sprite_askWait">
            <value name="MESSAGE">
              <shadow type="text">
                <field name="TEXT">What's your name?</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_answer"></block>
          <block type="sprite_keyPress">
            <field name="KEY">space</field>
          </block>
          <block type="sprite_mouseDown"></block>
          <block type="sprite_getMouseXY">
            <field name="XY">x</field>
          </block>
          <block type="sprite_getMouseXY">
            <field name="XY">y</field>
          </block>
          <block type="sprite_setDragMode"></block>
          <block type="sprite_getLoudness"></block>
          <block type="sprite_getTimer"></block>
          <block type="sprite_resetTimer"></block>
          <block type="sprite_getStage"></block>
          <block type="sprite_getDate">
            <field name="OPTION">year</field>
          </block>
          <block type="sprite_getSince">
            <field name="OPTION">days</field>
          </block>
          <block type="sprite_getUsername"></block>

          <label text="Operators"></label>
          <block type="sprite_operator">
            <field name="OPTION">+</field>
            <value name="VALUE1">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">2</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_operator">
            <field name="OPTION">-</field>
            <value name="VALUE1">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">2</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_operator">
            <field name="OPTION">*</field>
            <value name="VALUE1">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">2</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_operator">
            <field name="OPTION">/</field>
            <value name="VALUE1">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">2</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_operator">
            <field name="OPTION">mod</field>
            <value name="VALUE1">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">2</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_getRandom">
            <value name="MIN">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="MAX">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_conditionalOperator">
            <field name="OPTION">></field>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_conditionalOperator">
            <field name="OPTION">=</field>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_conditionalOperator">
            <field name="OPTION"><</field>
            <value name="VALUE2">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_conditionalOperator">
            <field name="OPTION">and</field>
          </block>
          <block type="sprite_conditionalOperator">
            <field name="OPTION">or</field>
          </block>
          <block type="sprite_notOperator"></block>
          <block type="sprite_join">
            <value name="VALUE1">
              <shadow type="text">
                <field name="TEXT">pen</field>
              </shadow>
            </value>
            <value name="VALUE2">
              <shadow type="text">
                <field name="TEXT">pineapple</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_letterAt">
            <value name="INDEX">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="VALUE">
              <shadow type="text">
                <field name="TEXT">pen-pineapple</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_length">
            <value name="VALUE">
              <shadow type="text">
                <field name="TEXT">pen-pineapple</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_contains">
            <value name="VALUE">
              <shadow type="text">
                <field name="TEXT">pen-pineapple</field>
              </shadow>
            </value>
            <value name="LOOKUP">
              <shadow type="text">
                <field name="TEXT">apple</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_unaryOperator">
            <field name="OPTION">round</field>
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">33.33</field>
              </shadow>
            </value>
          </block>
          <block type="sprite_unaryOperator">
            <field name="OPTION">abs</field>
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">-10</field>
              </shadow>
            </value>
          </block>


          <label text="Variables"></label>
          <block type="sprite_emptyList"></block>


          <!--
          <label text="EVENT"></label>
          <block type="sprite_flagClicked"></block>

          <label text="SENSE"></label>
          <block type="sprite_senseTouch">
            <value name="SPRITE">
              <block type="variables_get">
                <field name="VAR">sprite</field>
              </block>
            </value>
          </block>
          <block type="sprite_touch_color"></block>

          <label text="LOOK"></label>
          <block type="sprite_say"></block>

          <label text="CONTROL"></label>
          <block type="sprite_forever"></block>
          <block type="controls_if"></block>
          &lt;!&ndash;<block type="controls_if">
            <value name="ELSE"></value>
          </block>&ndash;&gt;

          <label text="LOGIC"></label>
          <block type="logic_negate"></block>
          <block type="logic_compare"></block>

          <label text="TEXT"></label>
          <block type="text_join"></block>

          <label text="VARIABLE"></label>
          <block type="sprite_empty_list">
            <value name="VARIABLE">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_indexOf"></block>
          <block type="lists_setIndex"></block>
          -->
        </category>

        <category name="Text" style="text_category">
          <block type="text"></block>
          <block type="text_join"></block>
          <block type="text_append">
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <block type="text_length">
            <value name="VALUE">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_isEmpty">
            <value name="VALUE">
              <shadow type="text">
                <field name="TEXT"></field>
              </shadow>
            </value>
          </block>
          <block type="text_indexOf">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">text</field>
              </block>
            </value>
            <value name="FIND">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_charAt">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">text</field>
              </block>
            </value>
          </block>
          <block type="text_getSubstring">
            <value name="STRING">
              <block type="variables_get">
                <field name="VAR">text</field>
              </block>
            </value>
          </block>
          <block type="text_changeCase">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_trim">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_count">
            <value name="SUB">
              <shadow type="text"></shadow>
            </value>
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <block type="text_replace">
            <value name="FROM">
              <shadow type="text"></shadow>
            </value>
            <value name="TO">
              <shadow type="text"></shadow>
            </value>
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <block type="text_reverse">
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <label text="Input/Output:" web-class="ioLabel"></label>
          <block type="text_print">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_prompt_ext">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
        </category>
        <category name="Lists" style="list_category">
          <block type="lists_create_with">
            <mutation items="0"></mutation>
          </block>
          <block type="lists_create_with"></block>
          <block type="lists_repeat">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">5</field>
              </shadow>
            </value>
          </block>
          <block type="lists_length"></block>
          <block type="lists_isEmpty"></block>
          <block type="lists_indexOf">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_getIndex">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_setIndex">
            <value name="LIST">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_getSublist">
            <value name="LIST">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_split">
            <value name="DELIM">
              <shadow type="text">
                <field name="TEXT">,</field>
              </shadow>
            </value>
          </block>
          <block type="lists_sort"></block>
          <block type="lists_reverse"></block>
        </category>
        <category name="Colour" style="colour_category">
          <block type="colour_picker"></block>
          <block type="colour_random"></block>
          <block type="colour_rgb">
            <value name="RED">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
            <value name="GREEN">
              <shadow type="math_number">
                <field name="NUM">50</field>
              </shadow>
            </value>
            <value name="BLUE">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="colour_blend">
            <value name="COLOUR1">
              <shadow type="colour_picker">
                <field name="COLOUR">#ff0000</field>
              </shadow>
            </value>
            <value name="COLOUR2">
              <shadow type="colour_picker">
                <field name="COLOUR">#3333ff</field>
              </shadow>
            </value>
            <value name="RATIO">
              <shadow type="math_number">
                <field name="NUM">0.5</field>
              </shadow>
            </value>
          </block>
        </category>
        <sep></sep>
        <category name="Variables" style="variable_category" custom="VARIABLE"></category>
        <category name="Functions" style="procedure_category" custom="PROCEDURE"></category>
        <sep></sep>
      </xml>

      <!-- toolbox-categories-typed-variables has a category menu and an
      auto-closing flyout.  The Variables category uses typed variable blocks.
      See https://developers.google.com/blockly/guides/create-custom-blocks/variables#typed_variable_blocks for more information. -->
      <xml id="toolbox-categories-typed-variables" style="display: none">
        <category name="Logic" style="logic_category">
          <block type="controls_if"></block>
          <block type="logic_compare"></block>
          <block type="logic_operation"></block>
          <block type="logic_negate"></block>
          <block type="logic_boolean"></block>
          <block type="logic_null" disabled="true"></block>
          <block type="logic_ternary"></block>
        </category>
        <category name="Loops" style="loop_category">
          <block type="controls_repeat_ext">
            <value name="TIMES">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="controls_repeat" disabled="true"></block>
          <block type="controls_whileUntil"></block>
          <block type="controls_for">
            <value name="FROM">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="TO">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
            <value name="BY">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
          <block type="controls_forEach"></block>
          <block type="controls_flow_statements"></block>
        </category>
        <category name="Math" style="math_category">
          <block type="math_number" gap="32">
            <field name="NUM">123</field>
          </block>
          <block type="math_arithmetic">
            <value name="A">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="B">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
          <block type="math_single">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">9</field>
              </shadow>
            </value>
          </block>
          <block type="math_trig">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">45</field>
              </shadow>
            </value>
          </block>
          <block type="math_constant"></block>
          <block type="math_number_property">
            <value name="NUMBER_TO_CHECK">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="math_round">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">3.1</field>
              </shadow>
            </value>
          </block>
          <block type="math_on_list"></block>
          <block type="math_modulo">
            <value name="DIVIDEND">
              <shadow type="math_number">
                <field name="NUM">64</field>
              </shadow>
            </value>
            <value name="DIVISOR">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="math_constrain">
            <value name="VALUE">
              <shadow type="math_number">
                <field name="NUM">50</field>
              </shadow>
            </value>
            <value name="LOW">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="HIGH">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
          </block>
          <block type="math_random_int">
            <value name="FROM">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="TO">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
          </block>
          <block type="math_random_float"></block>
          <block type="math_atan2">
            <value name="X">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
            <value name="Y">
              <shadow type="math_number">
                <field name="NUM">1</field>
              </shadow>
            </value>
          </block>
        </category>
        <category name="Text" style="text_category">
          <block type="text"></block>
          <block type="text_join"></block>
          <block type="text_append">
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <block type="text_length">
            <value name="VALUE">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_isEmpty">
            <value name="VALUE">
              <shadow type="text">
                <field name="TEXT"></field>
              </shadow>
            </value>
          </block>
          <block type="text_indexOf">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">text</field>
              </block>
            </value>
            <value name="FIND">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_charAt">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">text</field>
              </block>
            </value>
          </block>
          <block type="text_getSubstring">
            <value name="STRING">
              <block type="variables_get">
                <field name="VAR">text</field>
              </block>
            </value>
          </block>
          <block type="text_changeCase">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_trim">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_count">
            <value name="SUB">
              <shadow type="text"></shadow>
            </value>
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <block type="text_replace">
            <value name="FROM">
              <shadow type="text"></shadow>
            </value>
            <value name="TO">
              <shadow type="text"></shadow>
            </value>
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <block type="text_reverse">
            <value name="TEXT">
              <shadow type="text"></shadow>
            </value>
          </block>
          <label text="Input/Output:" web-class="ioLabel"></label>
          <block type="text_print">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
          <block type="text_prompt_ext">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">abc</field>
              </shadow>
            </value>
          </block>
        </category>
        <category name="Lists" style="list_category">
          <block type="lists_create_with">
            <mutation items="0"></mutation>
          </block>
          <block type="lists_create_with"></block>
          <block type="lists_repeat">
            <value name="NUM">
              <shadow type="math_number">
                <field name="NUM">5</field>
              </shadow>
            </value>
          </block>
          <block type="lists_length"></block>
          <block type="lists_isEmpty"></block>
          <block type="lists_indexOf">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_getIndex">
            <value name="VALUE">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_setIndex">
            <value name="LIST">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_getSublist">
            <value name="LIST">
              <block type="variables_get">
                <field name="VAR">list</field>
              </block>
            </value>
          </block>
          <block type="lists_split">
            <value name="DELIM">
              <shadow type="text">
                <field name="TEXT">,</field>
              </shadow>
            </value>
          </block>
          <block type="lists_sort"></block>
          <block type="lists_reverse"></block>
        </category>
        <category name="Colour" style="colour_category">
          <block type="colour_picker"></block>
          <block type="colour_random"></block>
          <block type="colour_rgb">
            <value name="RED">
              <shadow type="math_number">
                <field name="NUM">100</field>
              </shadow>
            </value>
            <value name="GREEN">
              <shadow type="math_number">
                <field name="NUM">50</field>
              </shadow>
            </value>
            <value name="BLUE">
              <shadow type="math_number">
                <field name="NUM">0</field>
              </shadow>
            </value>
          </block>
          <block type="colour_blend">
            <value name="COLOUR1">
              <shadow type="colour_picker">
                <field name="COLOUR">#ff0000</field>
              </shadow>
            </value>
            <value name="COLOUR2">
              <shadow type="colour_picker">
                <field name="COLOUR">#3333ff</field>
              </shadow>
            </value>
            <value name="RATIO">
              <shadow type="math_number">
                <field name="NUM">0.5</field>
              </shadow>
            </value>
          </block>
        </category>
        <sep></sep>
        <category name="Variables" style="variable_category" custom="VARIABLE_DYNAMIC"></category>
        <category name="Functions" style="procedure_category" custom="PROCEDURE"></category>
      </xml>
      <div id="importedFunctions">imported functions</div>
      <!-- toolbox-test-blocks has a category menu and an auto-closing flyout.
      The blocks in this toolbox reflect block configurations not used by
      the standard predefined blocks, and so test alernative block rendering
      code paths. -->
      <xml id="toolbox-test-blocks" style="display: none">
        <category name="Basic">
          <block type="empty_block"></block>
          <block type="empty_block_with_mutator"></block>
          <block type="value_to_stack"></block>
          <block type="value_to_statement"></block>
          <block type="limit_instances"></block>
        </category>
        <category name="Drag">
          <label text="Drag each to the workspace"></label>
          <block type="text_print">
            <value name="TEXT">
              <block type="text">
                <field name="TEXT">Drag me by this child</field>
              </block>
            </value>
          </block>
          <block type="text_print">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">Drag me by this shadow</field>
              </shadow>
            </value>
          </block>
          <block type="text_print">
            <value name="TEXT">
              <shadow type="text">
                <field name="TEXT">Shadow value</field>
              </shadow>
            </value>
            <next>
              <shadow type="text_print">
                <value name="TEXT">
                  <shadow type="text">
                    <field name="TEXT">Shadow statement</field>
                  </shadow>
                </value>
              </shadow>
            </next>
          </block>
          <label text="Multiple Variable Refs"></label>
          <block type="text_print">
            <value name="TEXT">
              <block type="variables_get">
                <field name="VAR" id="item" variabletype="">item</field>
              </block>
            </value>
            <next>
              <block type="text_print">
                <value name="TEXT">
                  <block type="variables_get">
                    <field name="VAR" id="item" variabletype="">item</field>
                  </block>
                </value>
              </block>
            </next>
          </block>
          <label text="Procedure Definitions"></label>
          <block type="procedures_defnoreturn">
            <field name="NAME">without arguments</field>
            <statement name="STACK">
              <block type="text_print">
                <value name="TEXT">
                  <shadow type="text">
                    <field name="TEXT">No argument reference.</field>
                  </shadow>
                </value>
              </block>
            </statement>
          </block>
          <block type="procedures_defnoreturn">
            <mutation>
              <arg name="fnArgument"></arg>
            </mutation>
            <field name="NAME">with one argument</field>
            <statement name="STACK">
              <block type="text_print">
                <value name="TEXT">
                  <shadow type="text">
                    <field name="TEXT">Expected an argument reference here.</field>
                  </shadow>
                  <block type="variables_get">
                    <field name="VAR">fnArgument</field>
                  </block>
                </value>
              </block>
            </statement>
          </block>
        </category>
        <category name="Fields">
          <label text="Numbers"></label>
          <block type="test_number">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_integer">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_number_hundredths">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_integer_bounded">
            <field name="NOTE">60</field>
          </block>
          <label text="Drop-downs"></label>
          <block type="example_dropdown_long"></block>
          <block type="example_dropdown_images"></block>
          <block type="example_dropdown_images_and_text"></block>
          <label text="Dynamic Drop-downs"></label>
          <block type="test_dropdown_dynamic"></block>
          <button text="Add option" callbackKey="addDynamicOption"></button>
          <button text="Remove option" callbackKey="removeDynamicOption"></button>
          <label text="Others"></label>
          <block type="example_angle"></block>
          <block type="example_date"></block>
        </category>
        <category name="Mutators">
          <label text="logic_compare"></label>
          <block type="logic_compare">
            <value name="A">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
            <value name="B">
              <shadow type="math_number">
                <field name="NUM">10</field>
              </shadow>
            </value>
          </block>
          <block type="logic_compare">
            <value name="A">
              <block type="math_number">
                <field name="NUM">10</field>
              </block>
            </value>
            <value name="B">
              <block type="math_number">
                <field name="NUM">10</field>
              </block>
            </value>
          </block>
        </category>
        <category name="Style">
          <label text="Hats"></label>
          <block type="styled_event_cap"></block>
          <label text="Colour"></label>
          <block type="block_colour_hex1"></block>
          <block type="block_colour_hex2"></block>
          <block type="block_colour_hex3"></block>
          <block type="block_no_colour"></block>
          <block type="block_colour_hex4"></block>
          <block type="block_colour_hex5"></block>
        </category>
        <category name="Images">
          <block type="image_datauri"></block>
          <block type="image_small"></block>
          <block type="image_large"></block>
          <block type="image_fliprtl"></block>
          <block type="image_missing"></block>
          <block type="test_with_lots_of_network_icons"></block>
          <label text="Unicode & Emojis"></label>
          <block type="emoji_label_robot_face"></block>
          <block type="text">
            <field name="TEXT">Robot face in text field: &#x1f916;</field>
          </block>
          <block type="text">
            <field name="TEXT">Zalgo in text field: B&#776;&#788;&#862;&#795;&#842;&#827;&#806;&#837;&#812;&#792;&#816;&#846;&#805;l&#771;&#832;&#833;&#864;&#849;&#849;&#789;&#861;&#801;&#854;&#863;&#811;&#826;&#812;&#790;&#803;&#819;o&#843;&#777;&#778;&#785;&#831;&#829;&#794;&#825;&#857;&#814;&#802;&#811;&#852;c&#843;&#786;&#849;&#778;&#861;&#775;&#825;&#825;&#796;&#857;&#825;&#800;&#824;k&#778;&#850;&#833;&#774;&#772;&#782;&#862;&#770;&#789;&#788;&#841;&#801;&#811;&#860;&#839;&#790;&#819;&#854;l&#832;&#774;&#836;&#831;&#776;&#787;&#855;&#816;&#793;&#798;&#819;&#809;&#800;&#854;&#815;y&#864;&#783;&#856;&#773;&#832;&#808;&#799;&#839;&#814;&#840;&#812;&#793;&#818;&#801;</field>
          </block>
        </category>
      </xml>
    </div>
  </div>

</div>

</body>
<script src="../../jszip/dist/jszip.js"></script>
<script src="../../FileSaver/dist/FileSaver.js"></script>
<script src="../../blkImport.js"></script>
</html>
