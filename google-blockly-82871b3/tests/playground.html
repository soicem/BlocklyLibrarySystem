<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Playground</title>
  <script src="../blockly_uncompressed.js"></script>
  <script src="../generators/javascript.js"></script>
  <script src="../generators/javascript/logic.js"></script>
  <script src="../generators/javascript/loops.js"></script>
  <script src="../generators/javascript/math.js"></script>
  <script src="../generators/javascript/text.js"></script>
  <script src="../generators/javascript/lists.js"></script>
  <script src="../generators/javascript/colour.js"></script>
  <script src="../generators/javascript/variables.js"></script>
  <script src="../generators/javascript/variables_dynamic.js"></script>
  <script src="../generators/javascript/procedures.js"></script>
  <script src="../generators/javascript/import.js"></script>
  <script src="../generators/python.js"></script>
  <script src="../generators/python/logic.js"></script>
  <script src="../generators/python/loops.js"></script>
  <script src="../generators/python/math.js"></script>
  <script src="../generators/python/text.js"></script>
  <script src="../generators/python/lists.js"></script>
  <script src="../generators/python/colour.js"></script>
  <script src="../generators/python/variables.js"></script>
  <script src="../generators/python/variables_dynamic.js"></script>
  <script src="../generators/python/procedures.js"></script>
  <script src="../generators/python/import.js"></script>
  <script src="../msg/messages.js"></script>
  <script src="../blocks/logic.js"></script>
  <script src="../blocks/loops.js"></script>
  <script src="../blocks/math.js"></script>
  <script src="../blocks/text.js"></script>
  <script src="../blocks/lists.js"></script>
  <script src="../blocks/colour.js"></script>
  <script src="../blocks/variables.js"></script>
  <script src="../blocks/variables_dynamic.js"></script>
  <script src="../blocks/procedures.js"></script>
  <script src="../blocks/import.js"></script>

  <script src="../blocks/sprites/motions.js"></script>
  <script src="../blocks/sprites/looks.js"></script>
  <script src="../blocks/sprites/sounds.js"></script>
  <script src="../blocks/sprites/events.js"></script>
  <script src="../blocks/sprites/controls.js"></script>
  <script src="../blocks/sprites/sensing.js"></script>
  <script src="../blocks/sprites/operators.js"></script>
  <script src="../blocks/sprites/variables.js"></script>
  <script src="../generators/javascript/sprites/controls.js"></script>
  <script src="../generators/javascript/sprites/events.js"></script>
  <script src="../generators/javascript/sprites/looks.js"></script>
  <script src="../generators/javascript/sprites/motions.js"></script>
  <script src="../generators/javascript/sprites/operators.js"></script>
  <script src="../generators/javascript/sprites/sensing.js"></script>
  <script src="../generators/javascript/sprites/sounds.js"></script>
  <script src="blocks/test_blocks.js"></script>
  <script src="src/paint_editor.js"></script>
  <link rel="stylesheet" href="playground_css.css">

  <script src="../JSInterpreter/acorn.js"></script>
  <script src="../JSInterpreter/interpreter.js"></script>

  <script>
    'use strict';
    var blockWorkspace = null;
    var toolbox = null;

    function start() {

      setBackgroundColour();
      // Parse the URL arguments.
      var match = location.search.match(/dir=([^&]+)/);
      var rtl = match && match[1] == 'rtl';
      document.forms.options.elements.dir.selectedIndex = Number(rtl);
      toolbox = getToolboxElement();
      var toolboxNames = [
        'toolbox-categories',
        'toolbox-categories-typed-variables',
        'toolbox-simple',
        'toolbox-test-blocks'
      ];
      document.forms.options.elements.toolbox.selectedIndex =
          toolboxNames.indexOf(toolbox.id);
      match = location.search.match(/side=([^&]+)/);
      var side = match ? match[1] : 'start';
      document.forms.options.elements.side.value = side;
      // Create main workspace.
      blockWorkspace = Blockly.inject('blocklyDiv',
          {
            comments: true,
            collapse: true,
            disable: true,
            grid:
                {
                  spacing: 25,
                  length: 3,
                  colour: '#ccc',
                  snap: true
                },
            horizontalLayout: side == 'top' || side == 'bottom',
            maxBlocks: Infinity,
            maxInstances: {'limit_instances': 3},
            media: '../media/',
            oneBasedIndex: true,
            readOnly: false,
            rtl: rtl,
            scrollbars: true,
            toolbox: toolbox,
            toolboxPosition: side == 'top' || side == 'start' ? 'start' : 'end',
            zoom:
                {
                  controls: true,
                  wheel: true,
                  startScale: 1.0,
                  maxScale: 4,
                  minScale: 0.25,
                  scaleSpeed: 1.1
                }
          });
      // block이 바뀔 때마다 최신코드 생성
      blockWorkspace.addChangeListener(function(event) {
        if (!(event instanceof Blockly.Events.Ui)) {
          // Something changed. Parser needs to be reloaded.
          generateCodeAndLoadIntoInterpreter();
        }
      });
      addToolboxButtonCallbacks();
      // Restore previously displayed text.
      if (sessionStorage) {
        var text = sessionStorage.getItem('textarea');
        if (text) {
          document.getElementById('importExport').value = text;
        }
        // Restore event logging state.
        var state = sessionStorage.getItem('logEvents');
        logEvents(Boolean(Number(state)));
      } else {
        // MSIE 11 does not support sessionStorage on file:// URLs.
        logEvents(false);
      }
      tabInit();
    }

    function addToolboxButtonCallbacks() {
      blockWorkspace.registerButtonCallback(
          'addDynamicOption', Blockly.TestBlocks.addDynamicDropdownOption_);
      blockWorkspace.registerButtonCallback(
          'removeDynamicOption', Blockly.TestBlocks.removeDynamicDropdownOption_);
    }

    function changeTheme() {
      var theme = document.getElementById('themeChanger');
      if (theme.value === "modern") {
        Blockly.setTheme(Blockly.Themes.Modern);
      } else if (theme.value === "high_contrast") {
        Blockly.setTheme(Blockly.Themes.HighContrast);
      } else {
        Blockly.setTheme(Blockly.Themes.Classic);
      }
    }

    function setBackgroundColour() {
      // Set background colour to differentiate server vs local copy.
      if (location.protocol == 'file:') {
        var lilac = '#d6d6ff';
        document.body.style.backgroundColor = lilac;
      }
    }

    function getToolboxElement() {
      var match = location.search.match(/toolbox=([^&]+)/);
      // Default to the basic toolbox with categories and untyped variables,
      // but override that if the toolbox type is set in the URL.
      var toolboxSuffix = (match ? match[1] : 'categories');
      // The three possible values are: "simple", "categories",
      // "categories-typed-variables".
      return document.getElementById('toolbox-' + toolboxSuffix);
    }

    // 라이브러리 xml의 원형을 본따서 arg, type, name 을 바꾼 후 리턴
    function generateLibFuncXML(arr) {
      var argument = 0;

      if (arr['type'] === "procedures_defnoreturn") {
        arr['type'] = "import_statement"
      } else if (arr['type'] === "procedures_defreturn") {
        arr['type'] = "import_return"
      }

      if (arr['arg'] !== null && arr['arg'] !== undefined) {
        argument = Object.keys(arr['arg']).length;
      }

      var a = "<block type=\"" + arr['type'] + "\" y=\"138\">" + "\n" +
          "<mutation func=\"" + arr['funcName'] + "\" args=\"" + argument + "\">" + "\n";

      for (var key in arr['arg']) {
        // check if the property/key is defined in the object itself, not in parent
        if (arr['arg'].hasOwnProperty(key)) {
          a += "<arg name=\"" + arr['arg'][key] + "\"></arg>" + "\n"
        }
      }
      a += "</mutation>" + "\n" +
          "</block>" + "\n";
      console.log(a);
      return a;
    }

    // function xml parser
    function libFuncToMutationCode(libFunction) {
      var parser, xmlDoc, txt = "";
      var result = "<xml xmlns=\"http://www.w3.org/1999/xhtml\">" + "\n";

      parser = new DOMParser();
      xmlDoc = parser.parseFromString(libFunction, "text/xml");

      var blockObjects = xmlDoc.getElementsByTagName("block");
      //console.log(blockObjects)

      for (var blockIdx = 0; blockIdx < blockObjects.length; blockIdx++) {
        var dict = {};
        var x = blockObjects[blockIdx];
        if (x.getAttributeNode("type").nodeValue === "text_print") {
          continue;
        }
        var flag = 0;
        if (x.getAttributeNode("type").nodeValue === "procedures_defnoreturn") {
          flag = 1;
        }

        if (x.getAttributeNode("type").nodeValue === "procedures_defreturn") {
          flag = 1;
        }
        if (!flag) {
          continue;
        }
        console.log(x.getAttributeNode("type").nodeValue);

        dict["type"] = x.getAttributeNode("type").nodeValue;
        var xlen = x.childNodes.length;
        var y = x.firstChild;
        for (var i = 0; i < xlen; i++) {
          if (y.nodeName === "mutation") {
            var firstNode = y.firstChild;
            var mLen = y.childNodes.length;
            var argDict = {};
            for (var j = 0; j < mLen; j++) {
              if (firstNode.nodeName !== "#text") {
                txt += firstNode.nodeName + "<br>";
                console.log(firstNode.getAttributeNode("name").nodeValue);
                argDict[j] = firstNode.getAttributeNode("name").nodeValue
              }
              firstNode = firstNode.nextSibling
            }
            dict["arg"] = argDict
          } else if (y.nodeName === "field") {
            dict["funcName"] = y.childNodes[0].nodeValue;
            console.log(y.childNodes[0].nodeValue)
          }
          if (y.nodeType == 1) {
            txt += y.nodeName + "<br>";
          }
          y = y.nextSibling;
        }
        console.log(dict)
        result += generateLibFuncXML(dict)
      }
      result += "</xml>" + "\n";
      return result;
    }

    let state = true;
    function test1() {
      state = !state;

      if (state) {
        myCanvas.getHandler().startTrackMousePosition();
      } else {
        myCanvas.getHandler().stopTrackMousePosition();
      }
    }

    function test() {
      console.log(myCanvas.getSpriteAtPosition(new Point(250, 250)).getImageSource());
    }

    function myImport() {
      console.log("myImport");
      let input = document.getElementById("importExport");
      // convert function xml to library xml
      let convertedXml = libFuncToMutationCode(input.value);
      console.log(convertedXml);
      let xml = Blockly.Xml.textToDom(convertedXml);

      let childrenCount = xml.children.length || 0;
      for (let i = 0; i < childrenCount; i++) {
        let child = xml.children[i];

        let childIsBlock = (child.nodeName === "block");
        let childTypeIsImportReturn = (child.getAttribute("type") === "import_return");
        let childTypeIsImportStatement = (child.getAttribute("type") === "import_statement");

        if (childIsBlock && (childTypeIsImportReturn || childTypeIsImportStatement)) {
          document.getElementById("toolbox-categories").querySelector("[name='Import']").append(
              child);
          i--;
          childrenCount--;
        }
      }

      collapseToolbox();
      blockWorkspace.updateToolbox(document.getElementById("toolbox-categories"));
    }

    function collapseToolbox() {
      let tree = blockWorkspace.getToolbox().tree_;

      if (tree) {
        tree.setSelectedItem(null);
      }
    }

    function toXml() {
      var xml = Blockly.Xml.workspaceToDom(blockWorkspace);
      var output = document.getElementById('importExport');

      output.value = Blockly.Xml.domToPrettyText(xml);
      output.focus();
      output.select();
      taChange();

      CurrentSpritesXML();
      ImgToFile();          // for img
      SpriteXMLtoBLK();     //for xml
      jsFile();           // for JS

      CreateBLK('Test');
    }

    //----check
    //import
    function ExtractFiles(id) {
      var BLK = document.getElementById(id);
      var tmpJS = {};

      var files = BLK.files[0]; // FileList object
      var reader = new FileReader();

      reader.onload = (function () {
        return function (evt) {
          JSZip.loadAsync(evt.target.result)
          .then(function (blk) {
            blk.forEach(function (relativePath, file) {
              if ((file.name).indexOf("backImage/") !== -1) { // for images;
                var strArray = (file.name).split('/');
                var picture = strArray[1];

                file.async('base64')
                .then(function (data) {
                  if ((picture !== "") && (picture !== null) && (picture !== undefined)) {
                    myCanvas.addStage(picture, data);
                    // myCanvas.getSpriteByName(picture).draw();
                    addStage(picture, data);
                    myCanvas.setCurrentSpriteName(picture);
                  }
                });
              } else if ((file.name).indexOf("images/") !== -1) { // for images;
                var strArray = (file.name).split('/');
                var picture = strArray[1];

                file.async('base64')
                .then(function (data) {
                  if ((picture !== "") && (picture !== null) && (picture !== undefined)) {
                    myCanvas.addSprite(picture, data);
                    // myCanvas.getSpriteByName(picture).draw();
                    addSprite(picture, data);
                    myCanvas.setCurrentSpriteName(picture);
                  }
                });
              } else if ((file.name).indexOf(".xml") !== -1) { //xml
                var xmlName = file.name.substring(0, (file.name).indexOf(".xml"));
                file.async('text')
                .then(function (data) {
                  myCanvas.getSpriteByName(xmlName).setXml(data);
                  setSpriteXML();
                })
              } else if ((file.name.indexOf('.js') !== -1) && (file.name.indexOf('.json') === -1)) {
                var jsName = file.name.substring(0, (file.name).indexOf(".js"));
                file.async('text')
                .then(function (data) {
                  if (myCanvas.getSpriteByName(jsName) === undefined) {
                    if (jsName !== "") {
                      tmpJS[jsName] = data;
                    }
                  } else {
                    console.log(data);
                    myCanvas.setLibCode(data);
                    myCanvas.getSpriteByName(jsName).setJsCode(data);
                  }
                  //console.log(jsName);
                  //console.log(data)
                })
              }
            })
          }).then(function () {
            setTimeout(function () {
              var isEmpty = Object.keys(tmpJS).length;
              var matching;

              if (isEmpty > 0) {
                matching = Object.keys(tmpJS);
                matching.forEach(function (data) {
                  console.log(tmpJS[data])
                  myCanvas.setLibCode(tmpJS[data]);
                  myCanvas.getSpriteByName(data).setJsCode(tmpJS[data]);
                })
              }

              let xml = Blockly.Xml.textToDom(myCanvas.getCurrentSprite().getXml());
              if(id === "getLib"){
                myImport()
              } else
                Blockly.Xml.domToWorkspace(xml, blockWorkspace);
            }, 100);
          });
        };
      })(files);
      reader.readAsArrayBuffer(files);
    }

    function addSprite(name, Source) {
      if (Source === null || Source === undefined || Source === "") {
        return;
      }

      var base = "data:image/png;base64," + Source;

      var a = '<div class="spriteImg\" id="' + name + '" onclick="myCanvas.setCurrentSprite(\'' + name + '\')">' +
          '<img src="' + base + '" alt="냥">' +
          '<div class="desc">냥</div>' +
          '</div>';

      document.getElementById("spriteGallery").innerHTML += a;
    }

    function addStage(name, Source) {
      if (Source === null || Source === undefined || Source === "") {
        return;
      }

      var base = "data:image/png;base64," + Source;

      var a = '<div class="stage\" id="' + name + '" onclick="myCanvas.setCurrentSprite(\'' + name + '\')">' +
          '<img src="' + base + '" alt="냥">' +
          '<div class="desc">냥</div>' +
          '</div>';

      document.getElementById("stageGallery").innerHTML += a;
    }

    function setSpriteXML() {
      var first_value = Object.keys(myCanvas.getSprites())[0];

      var output = document.getElementById('importExport');
      output.value = myCanvas.getSpriteByName(first_value).getXml();
      taChange();
    }

    //export
    function SpriteXMLtoBLK() {
      var arraySprite = Object.getOwnPropertyNames(myCanvas.getSprites());

      arraySprite.forEach((name) => {
        console.log(name + ": " + myCanvas.getSpriteByName(name).getXml());
        FileToBLK(name + ".xml", myCanvas.getSpriteByName(name).getXml(), false);
      });

    }

    function CurrentSpritesXML() {
      var xml = Blockly.Xml.workspaceToDom(blockWorkspace);
      var XmlText = Blockly.Xml.domToPrettyText(xml);
      myCanvas.getCurrentSprite().setXml(XmlText);
    }

    function ImgToFile() {
      // var arraySprite = Object.getOwnPropertyNames(myCanvas.getSprites());
      //
      // arraySprite.forEach((name) => {
      //   if (name !== "aww-cat.png") {
      //     ImgToBLK(name, myCanvas.getSpriteByName(name).getImageData());
      //   }
      // });

      const stage = myCanvas.getSpritesOrder()[0];
      if (stage) {
        BackImgToBLK(stage.getImageFilename(), stage.getImageData());
      }

      for (let i = 1; i < myCanvas.getSpritesOrder().length; i++) {
        const sprite = myCanvas.getSpritesOrder()[i];
        ImgToBLK(sprite.getImageFilename(), sprite.getImageData());
      }
    }

    function fromXml() {
      var input = document.getElementById('importExport');
      var xml = Blockly.Xml.textToDom(input.value);
      Blockly.Xml.domToWorkspace(xml, blockWorkspace);
      taChange();
    }

    /*
        function sendAjax(url, main, libraries) {
          // langType - 0:py 1:lua 2:dart 3:php
          // libraryFunction number
          var data = {'langType': 0, 'main': main, 'libraries': libraries};
          data = JSON.stringify(data)
          var xhr = new XMLHttpRequest();
          xhr.open('POST', url);
          xhr.setRequestHeader('Content-Type', "application/json");
          xhr.send(data);
          xhr.addEventListener('load', function () {
            var result = JSON.parse(xhr.responseText);
            if (result.result !== "ok") {
              return;
            }
            alert(result.output);
            //document.querySelector(".result").innerHTML = result.output;
          })
        }
    */

    function jsFile() {
      var arraySprite = Object.getOwnPropertyNames(myCanvas.getSprites());
      var result, DOM;

      arraySprite.forEach(function (name) {
        // myCanvas.getSpriteByName(name).draw();

        DOM = Blockly.Xml.textToDom(myCanvas.getSpriteByName(name).getXml());
        blockWorkspace.clear();
        Blockly.Xml.domToWorkspace(DOM, blockWorkspace);
        result = Blockly['JavaScript'].workspaceToCode(blockWorkspace);
        console.log(result);
        myCanvas.setLibCode(result);
        myCanvas.getSpriteByName(name).setJsCode(result);
        // canvas.clear();

        console.log(name + ' : ' + result);
        FileToBLK(name + '.js', result, true);
      })
    }

    function delayWraper(keyOfSprite) {
      return new Promise(function (resolve, reject) {
        setTimeout(function () {
          console.log("keyOfSprite : " , keyOfSprite)
          myCanvas.setSpecificSpriteName(keyOfSprite);
          var isFalse = stepCode(keyOfSprite);
          resolve(isFalse);
        }, 2);
      });
    }
    function goStep(){
      for(var i = 1; i < myCanvas.getSpritesOrder().length; i++){
        _goStep(myCanvas.getSpritesOrder()[i].getImageFilename())
      }
    }

    function _goStep(keyOfSprite){
      delayWraper(keyOfSprite)
              .then(
                      function (result) {
                        if(result != false)
                          _goStep(keyOfSprite);
                      }
              );
    }

    function initApi(interpreter, scope) {
      interpreter.setProperty(scope, 'moveSteps',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().moveSteps(parseInt(text));

              }));

      interpreter.setProperty(scope, 'say',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().say(text);
              }));

      interpreter.setProperty(scope, 'setDirection',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                myCanvas.getSpecificSprite().changeDirection(text);
              }));

      interpreter.setProperty(scope, 'isTouchingColorHex',
              interpreter.createNativeFunction(function(hexValue) {
                hexValue = hexValue ? hexValue.toString() : '';
                //console.log(myCanvas.getSpritesOrder()[0].isTouchingColorHex("#000000"));
                //console.log(myCanvas.getSpritesOrder()[0].isTouchingColorHex(hexValue));
                return myCanvas.getSpecificSprite().isTouchingColorHex(hexValue);
              }));

      interpreter.setProperty(scope, 'sprite_getX',
              interpreter.createNativeFunction(function() {
                console.log(myCanvas.getSpecificSprite().getX());
                return myCanvas.getSpecificSprite().getX();
              }));

      interpreter.setProperty(scope, 'sprite_getY',
              interpreter.createNativeFunction(function() {
                console.log(myCanvas.getSpecificSprite().getY());
                return myCanvas.getSpecificSprite().getY();
              }));

      interpreter.setProperty(scope, 'setXY',
              interpreter.createNativeFunction(function(x, y) {
                //text = text ? text.toString() : '';
                x = parseInt(x);
                y = parseInt(y);
                myCanvas.getSpecificSprite().goToPoint(x, y);
              }));

      // Add an API function for the alert() block, generated for "text_print" blocks.
      interpreter.setProperty(scope, 'alert',
              interpreter.createNativeFunction(function(text) {
                text = text ? text.toString() : '';
                var output = document.getElementById('importExport');
                output.value += '\n' + text;
              }));

      // Add an API function for the prompt() block.
      var wrapper = function(text) {
        text = text ? text.toString() : '';
        return interpreter.createPrimitive(prompt(text));
      };
      interpreter.setProperty(scope, 'prompt',
              interpreter.createNativeFunction(wrapper));

      // Add an API function for highlighting blocks.
      var wrapper = function(id) {
        id = id ? id.toString() : '';
        return interpreter.createPrimitive(highlightBlock(id));
      };
      interpreter.setProperty(scope, 'highlightBlock',
              interpreter.createNativeFunction(wrapper));
    }

    function highlightBlock(id) {
      blockWorkspace.highlightBlock(id);
      highlightPause = true;
    }

    function resetStepUi(clearOutput) {
      blockWorkspace.highlightBlock(null);
      highlightPause = false;

      if (clearOutput) {
        var output = document.getElementById('importExport');
        output.value = 'Program output:\n=================';
      }
    }

    var myInterpreters = {};
    var highlightPause = false;
    var latestCodes = {};

    function generateCodeAndLoadIntoInterpreter() {
      // Generate JavaScript code and parse it.
      Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\n';
      Blockly.JavaScript.addReservedWords('highlightBlock');
      let keyOfLatestCode = myCanvas.getCurrentSpriteName()
      latestCodes[keyOfLatestCode] = Blockly["JavaScript"].workspaceToCode(blockWorkspace);
      //latestCode = Blockly["JavaScript"].workspaceToCode(blockWorkspace);
      var libCode = myCanvas.getLibCode();
      console.log("lib : " , libCode)
      if(libCode){
        latestCodes[keyOfLatestCode] += latestCodes[keyOfLatestCode] + "\n\n" + libCode;
      }
      console.log("latestCodes : ", latestCodes);

      // step execution 용 코드
      if(!myInterpreters[myCanvas.getCurrentSpriteName()])
        console.log("soicem");
      for(var i = 1; i < myCanvas.getSpritesOrder().length; i++){
        console.log(myCanvas.getSpritesOrder()[i].getImageFilename());
      }
    }
    function stepCode(keyOfSprite) {
      var keyOfCode = keyOfSprite;
      if (!myInterpreters[keyOfCode]) {
        // First statement of this code.
        // Clear the program output.
        resetStepUi(true);
        myInterpreters[keyOfCode] = new Interpreter(latestCodes[keyOfCode], initApi);
        return;
      }
      highlightPause = false;

      do {
        try {
          var hasMoreCode = myInterpreters[keyOfCode].step();
        } finally {
          if (!hasMoreCode) {
            // Program complete, no more code to execute.
            var output = document.getElementById('importExport');
            output.value += '\n\n<< Program complete >>';

            myInterpreters[keyOfCode] = null;
            resetStepUi(false);

            // Cool down, to discourage accidentally restarting the program.
            //stepButton.disabled = 'disabled';
            return false;
          }
        }
        // Keep executing until a highlight statement is reached,
        // or the code completes or errors.
      } while (hasMoreCode && !highlightPause);

    }

    // Load the interpreter now, and upon future changes.
    //generateCodeAndLoadIntoInterpreter();


    // block을 Javascript 코드로 변환하고, 이를 실행시킨다.
    function toJSCode() {
      let output = document.getElementById('importExport');
      output.value = Blockly["JavaScript"].workspaceToCode(blockWorkspace);
      //canvas.clear();
      //alert(output.value);
      //objectsOfSprites[currentSprite].jsCode = output.value;
      myCanvas.getCurrentSprite().printProperties();
      // objectsOfSprites[currentSprite].printProperties();
      myCanvas.getCurrentSprite().executeJS(output.value);
      // objectsOfSprites[currentSprite].executeJS(output.value);
      //console.log(objectsOfSprites[currentSprite].jsCode);
      //objectsOfSprites[currentSprite].printProperties()
      //objectsOfSprites[currentSprite].draw();
      console.log(myCanvas.getCurrentSprite());
    }

    function toCodeMain() {
      //var lang = document.getElementById('mainLang');
      output.value = Blockly["Python"].workspaceToCode(blockWorkspace);
      var libFunction = samplePy();
      var pyCode = output.value;
      pyCode = "from testFunction import *\n" + pyCode;
      var libraries = {
        'numberOfLibs': 1, 'libraryInfo': {
          0: {"name": "testFunction", "body": libFunction}
        }
      };
      console.log(pyCode);
      console.log(libFunction);

      sendAjax('http://127.0.0.1:3000/ajax_send_email', pyCode, libraries);
      taChange();
    }

    function toCodeLib() {
      var lang = document.getElementById('libLang');
      output.value = Blockly[lang.value].workspaceToCode(libraryspace);
      var libFunction = samplePy();
      var pyCode = output.value;
      pyCode = "from testFunction import *\n" + pyCode;
      var libraries = {
        'numberOfLibs': 1, 'libraryInfo': {
          0: {"name": "testFunction", "body": libFunction}
        }
      };
      console.log(pyCode);
      console.log(libFunction);

      sendAjax('http://127.0.0.1:3000/ajax_send_email', pyCode, libraries);
      taChange();
    }

    // Disable the "Import from XML" button if the XML is invalid.
    // Preserve text between page reloads.
    function taChange() {
      var textarea = document.getElementById('importExport');
      if (sessionStorage) {
        sessionStorage.setItem('textarea', textarea.value);
      }
      var valid = true;
      try {
        Blockly.Xml.textToDom(textarea.value);
      } catch (e) {
        valid = false;
      }
      //document.getElementById('importExport').disabled = !valid;
    }

    function logEvents(state) {
      var checkbox = document.getElementById('logCheck');
      checkbox.checked = state;
      if (sessionStorage) {
        sessionStorage.setItem('logEvents', Number(state));
      }
      if (state) {
        blockWorkspace.addChangeListener(logger);
      } else {
        blockWorkspace.removeChangeListener(logger);
      }
    }

    function logger(e) {
      console.log(e);
    }

    function airstrike(n) {
      var prototypes = [];
      var toolbox = getToolboxElement();
      var blocks = toolbox.getElementsByTagName('block');
      for (var i = 0, block; block = blocks[i]; i++) {
        prototypes.push(block.getAttribute('type'));
      }
      for (var i = 0; i < n; i++) {
        var prototype = prototypes[Math.floor(Math.random() * prototypes.length)];
        var block = blockWorkspace.newBlock(prototype);
        block.initSvg();
        block.getSvgRoot().setAttribute('transform', 'translate(' +
            Math.round(Math.random() * 450 + 40) + ', ' +
            Math.round(Math.random() * 600 + 40) + ')');
        block.render();
      }
    }

    function spaghetti(n) {
      var xml = spaghettiXml;
      for (var i = 0; i < n; i++) {
        xml = xml.replace(/(<(statement|next)( name="DO0")?>)<\//g,
            '$1' + spaghettiXml + '</');
      }
      xml = '<xml xmlns="http://www.w3.org/1999/xhtml">' + xml + '</xml>';
      var dom = Blockly.Xml.textToDom(xml);
      console.time('Spaghetti domToWorkspace');
      Blockly.Xml.domToWorkspace(dom, blockWorkspace);
      console.timeEnd('Spaghetti domToWorkspace');
    }

    var spaghettiXml = [
      '  <block type="controls_if">',
      '    <value name="IF0">',
      '      <block type="logic_compare">',
      '        <field name="OP">EQ</field>',
      '        <value name="A">',
      '          <block type="math_arithmetic">',
      '            <field name="OP">MULTIPLY</field>',
      '            <value name="A">',
      '              <block type="math_number">',
      '                <field name="NUM">6</field>',
      '              </block>',
      '            </value>',
      '            <value name="B">',
      '              <block type="math_number">',
      '                <field name="NUM">7</field>',
      '              </block>',
      '            </value>',
      '          </block>',
      '        </value>',
      '        <value name="B">',
      '          <block type="math_number">',
      '            <field name="NUM">42</field>',
      '          </block>',
      '        </value>',
      '      </block>',
      '    </value>',
      '    <statement name="DO0"></statement>',
      '    <next></next>',
      '  </block>'].join('\n');

    function tabInit() {
      showTab('blocklyDiv', 'main_tab');
      hideTab('library', 'library_tab');
      hideTab('sprite', 'sprite_tab');
    }

    function changeTab(tab) {
      if (tab === "main_tab") {
        showTab('blocklyDiv', 'main_tab');
        hideTab('library', 'library_tab');
        hideTab('sprite', 'sprite_tab');
      } else if (tab === "library_tab") {
        showTab('library', 'library_tab');
        hideTab('blocklyDiv', 'main_tab');
        hideTab('sprite', 'sprite_tab')
      } else if (tab === "sprite_tab") {
        showTab('sprite', 'sprite_tab');
        hideTab('library', 'library_tab');
        hideTab('blocklyDiv', 'main_tab');
      }
      taChange();
    }

    function hideTab(page, tab) {
      document.getElementById(page).style.display = 'none';
      document.getElementById(tab).style.backgroundColor = '#333';
    }

    function showTab(page, tab) {
      document.getElementById(page).style.display = 'block';
      document.getElementById(tab).style.backgroundColor = 'green';
    }

    function loadImage(){
      var imgClo = new Image();
      imgClo.addEventListener('load', function(){
        var ctx = document.getElementById('spriteCanvas').getContext("2d");
        ctx.drawImage( imgClo , 250, 250);
      },false);
      imgClo.src="aww-cat.png";
    }

    function changeTextValue(textbox, value){
      document.getElementById(textbox).value = value;
    }

    function myStart() {
      animationUpdater = new AnimationUpdater();
      myCanvas = new Canvas(document.getElementById("canvas"), new Size(480, 400), blockWorkspace);

      myCanvas.addSpriteAndSelect("aww-cat.png");

      animationUpdater.addCallFunction({caller: myCanvas, method: myCanvas.render});
      animationUpdater.start();
      return myCanvas;
    }
  </script>


</head>
<body onload="start(); myStart();">
<ul>
  <h1>Blockly Playground</h1>
  <li><a id="main_tab" onclick="changeTab('main_tab')">Main</a></li>
  <li><a id="library_tab" onclick="changeTab('library_tab')">Library</a></li>
  <li><a id="sprite_tab" onclick="changeTab('sprite_tab')">Sprite</a></li>
</ul>
<br>
<!---- Main Tab ----->
<div id="blocklyDiv"></div>
<!--- Library Tab --->
<div id="library">
  <div id="librarySpace"></div>
  <p>
    <select id="libLang" name="lang" onchange="toCodeLib()">
      <option value="default">Select</option>
      <option value="JavaScript">JavaScript</option>
      <option value="Python">Python</option>
      <option value="PHP">PHP</option>
      <option value="Lua">Lua</option>
      <option value="Dart">Dart</option>
    </select>
    <br>
    <textarea id="importExport_" style="width: 90%; height: 70%;"
              onchange="taChange();" onkeyup="taChange()">
    </textarea>
  </p>
</div>
<!--- Sprite Tab ---->
<div id="sprite">

  <div id="spriteCanvas_container">
    <canvas id="spriteCanvas"></canvas>
  </div>
  <input type="button" value="파일 불러오기" onclick="loadImage()">
</div>
<!----- Content ----->
<div id="content">
  <div id="canvasArea" class="rounded">
  <div id="canvasBlock">
    <div id="canvases">
      <canvas id="canvas"></canvas>
    </div>
    <script src="src/animation/animation_updater.js"></script>
    <script src="src/canvas/canvas.js"></script>
    <script src="src/canvas/canvas_handler.js"></script>
    <script src="src/canvas/sprite.js"></script>
    <script src="src/canvas/sprite_factory.js"></script>
    <script src="src/canvas/speech_bubble.js"></script>
    <script src="src/math/point.js"></script>
    <script src="src/math/size.js"></script>
    <script src="src/math/angle.js"></script>
    <script src="src/math/degree.js"></script>
    <script src="src/math/radian.js"></script>
    <script src="src/exception/my_exception.js"></script>
    <script src="src/exception/sprite_exception.js"></script>

    <script>
      let animationUpdater;
      let myCanvas;

      function spriteChooser() {
        var name;
        var x = document.getElementById("spriteChooser");
        var txt = "";

        var imageFile = x.files[0];
        var reader = new FileReader();

        if ('files' in x) {
          if (x.files.length === 0) {
            txt = "Select one or more files.";
          } else {
            for (var i = 0; i < x.files.length; i++) {
              txt += "<br><strong>" + (i + 1) + ". file</strong><br>";
              var file = x.files[i];
              if ('name' in file) {
                txt += "name: " + file.name + "<br>";
                name = file.name;
              }
              if ('size' in file) {
                txt += "size: " + file.size + " bytes <br>";
              }
              if ('value' in file) {
                txt += "value: " + file.value + " bytes <br>";
              }
            }
          }
        } else {
          if (x.value === "") {
            txt += "Select one or more files.";
          } else {
            txt += "The files property is not supported by your browser!";
            txt += "<br>The path of the selected file: " + x.value; // If the browser does not support the files property, it will return the path of the selected file instead.
          }
        }
        var a = '<div class="spriteImg\" id="' + name + '" onclick="myCanvas.setCurrentSprite(\'' + name + '\')">'
                + '<img src="' + name + '" alt="냥">'
                + '<div class="desc">냥</div>'
                + '</div>';
        //alert(a);
        document.getElementById("spriteGallery").innerHTML += a;

        reader.addEventListener('load', function () {
          // sprite에 대한 canvas 용 objects를 저장한다.
          myCanvas.addSprite(name, reader.result);
          // myCanvas.getSpriteByName(name).draw();
          myCanvas.getSpriteByName(name).printProperties();
        });

        if (imageFile) {
          reader.readAsArrayBuffer(imageFile);
        }
      }

      function stageChooser() {
        var name;
        var x = document.getElementById("stageChooser");
        var txt = "";

        var imageFile = x.files[0];
        var reader = new FileReader();

        if ('files' in x) {
          if (x.files.length === 0) {
            txt = "Select one or more files.";
          } else {
            for (var i = 0; i < x.files.length; i++) {
              txt += "<br><strong>" + (i + 1) + ". file</strong><br>";
              var file = x.files[i];
              if ('name' in file) {
                txt += "name: " + file.name + "<br>";
                name = file.name;
              }
              if ('size' in file) {
                txt += "size: " + file.size + " bytes <br>";
              }
              if ('value' in file) {
                txt += "value: " + file.value + " bytes <br>";
              }
            }
          }
        } else {
          if (x.value === "") {
            txt += "Select one or more files.";
          } else {
            txt += "The files property is not supported by your browser!";
            txt += "<br>The path of the selected file: " + x.value; // If the browser does not support the files property, it will return the path of the selected file instead.
          }
        }
        var a = '<div class="stage\" id="' + name + '" onclick="myCanvas.setCurrentSprite(\'' + name + '\')">'
                + '<img src="' + name + '" alt="냥">'
                + '<div class="desc">냥</div>'
                + '</div>';
        document.getElementById("stageGallery").innerHTML += a;

        reader.addEventListener('load', function() {
          myCanvas.addStage(name, reader.result);
          // myCanvas.getSprite(name).draw();
          myCanvas.getSpriteByName(name).printProperties();
        });

        if (imageFile) {
          reader.readAsArrayBuffer(imageFile);
        }
      }
      </script>
    </div>
  </div>

  <div id="gallery_owner">
    <div id="sprite_owner" class="rounded">
      <div id="spriteAttributes">
        <ul1>
          <li1> X <input type="text" id="sprite_X" onchange="myCanvas.getCurrentSprite().getPosition().setX(parseInt(document.getElementById('sprite_X').value, 10))"> </li1>
          <li1> Y <input type="text" id="sprite_Y" onchange="myCanvas.getCurrentSprite().getPosition().setY(parseInt(document.getElementById('sprite_Y').value, 10))"> </li1>
        </ul1>
        <ul1>
          <li1> Height <input type="text" id="sprite_H" onchange="myCanvas.getCurrentSprite().getSize().setHeight(parseInt(document.getElementById('sprite_H').value, 10))"> </li1>
          <li1> Width <input type="text" id="sprite_W" onchange="myCanvas.getCurrentSprite().getSize().setWidth(parseInt(document.getElementById('sprite_W').value, 10))"> </li1>
        </ul1>
      </div>
      <div id="spriteGallery">
        <div class="spriteImg" id="aww-cat.png" onclick="myCanvas.setCurrentSprite('aww-cat.png')" style="border: solid 2px #415DCC;">
          <img src="aww-cat.png" alt="냐옹이">
          <div class="desc">냐옹</div>
        </div>
      </div>
      <div class="plusButtonContainer">
        <div class="plusButton">
          <span class="plus">
            <input type="file" id="spriteChooser" accept="image/*" multiple size="50" onchange="spriteChooser()">
          </span>
        </div>
      </div>

    </div>
    <div id="stage_owner" class="rounded">
      <div id="stageGallery"></div>
      <div class="plusButtonContainer">
        <div class="plusButton">
          <span class="plus">
            <input type="file" id="stageChooser" accept="image/*" multiple size="50" onchange="stageChooser()">
          </span>
        </div>
      </div>
    </div>
  </div>

  <div>
    <form id="options" style="display: none">
      <select name="dir" onchange="document.forms.options.submit()">
        <option value="ltr">LTR</option>
        <option value="rtl">RTL</option>
      </select>
      <select name="toolbox" onchange="document.forms.options.submit()">
        <option value="categories">Categories (untyped variables)</option>
        <option value="categories-typed-variables">Categories (typed variables)</option>
        <option value="simple">Simple</option>
        <option value="test-blocks">Test Blocks</option>
      </select>
      <select name="side" onchange="document.forms.options.submit()">
        <option value="start">Start</option>
        <option value="end">End</option>
        <option value="top">Top</option>
        <option value="bottom">Bottom</option>
      </select>
    </form>
    <select id="themeChanger" name="theme" onchange="changeTheme()" style="display:none">
      <option value="classic">Classic</option>
      <option value="modern">Modern</option>
      <option value="high_contrast">High Contrast</option></select>
    <div id="buttonCollection" class="rounded">
      <ul>
        <li2><a id="exportPro" onclick="toXml()">Export Project</a></li2>
        <li2 style="width:50%;">
          <a>
            <div>
              <label for="getFile">Import Project</label>

            </div>
          </a>

        </li2>
      </ul>
      <ul>
        <li2><a id="ExportLib" onclick="toXml()">Export Library</a></li2>
        <li2 style="width:50%;">
          <a>
            <div>
              <label for="getLib">Import Library</label>
            </div>
          </a>

        </li2>
      </ul>
      <ul>
        <li2><a id="toJavaScript" onclick="goStep()">To JavaScript</a></li2>
        <li2><a id="toCode" onclick="toCodeMain()">To Python</a></li2>
      </ul>

      <ul>
        <li2 style="width:50%;">
          <a id="insertBlk">
            <div id="filebox">
              <label for="getFile">Insert</label>
              <input type="file" value="add File" name="files[]" id="getFile" onchange="ExtractFiles(this.id)"
                   accept=".blk, .zip">
              <input type="file" value="add File" name="files[]" id="getLib" onchange="ExtractFiles(this.id)"
                     accept=".blk, .zip">

            </div>
          </a>

        </li2>
        <li2><a id="insertXML" onclick="fromXml()">insert from XML</a></li2>
      </ul>
      <textarea id="importExport" style="width: calc(100% - 5px); height: 60%"
                onchange="taChange();" onkeyup="taChange()"></textarea>
  </div>
<!--
    <p>
      Stress test: &nbsp;
      <input type="button" value="Airstrike!" onclick="airstrike(100)">
      <input type="button" value="Spaghetti!" onclick="spaghetti(8)">
    </p>
-->
    <p>
      <!--Log events: &nbsp;-->
      <input type="checkbox" onclick="logEvents(this.checked)" id="logCheck" style="display:none">
    </p>
    <!-- The next three blocks of XML are sample toolboxes for testing basic
    configurations.  For more information on building toolboxes, see https://developers.google.com/blockly/guides/configure/web/toolbox -->

    <!-- toolbox-simple is an always-open flyout with no category menu.
    Always-open flyouts are a good idea if you have a small number of blocks. -->
    <xml id="toolbox-simple" style="display: none">
      <block type="controls_ifelse"></block>
      <block type="logic_compare"></block>
      <!-- <block type="control_repeat"></block> -->
      <block type="logic_operation"></block>
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null" disabled="true"></block>
      <block type="logic_ternary"></block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">text</field>
          </block>
        </value>
      </block>
    </xml>

    <!-- toolbox-categories has a category menu and an auto-closing flyout.  The
    Variables category uses untyped variable blocks.
    See https://developers.google.com/blockly/guides/create-custom-blocks/variables#untyped_variable_blocks for more information. -->
    <xml id="toolbox-categories" style="display: none">
      <category name="Logic" style="logic_category">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null" disabled="true"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Loops" style="loop_category">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="controls_repeat" disabled="true"></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
      <category name="Math" style="math_category">
        <block type="math_number" gap="32">
          <field name="NUM">123</field>
        </block>
        <block type="math_arithmetic">
          <value name="A">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="math_single">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">9</field>
            </shadow>
          </value>
        </block>
        <block type="math_trig">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">45</field>
            </shadow>
          </value>
        </block>
        <block type="math_constant"></block>
        <block type="math_number_property">
          <value name="NUMBER_TO_CHECK">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="math_round">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">3.1</field>
            </shadow>
          </value>
        </block>
        <block type="math_on_list"></block>
        <block type="math_modulo">
          <value name="DIVIDEND">
            <shadow type="math_number">
              <field name="NUM">64</field>
            </shadow>
          </value>
          <value name="DIVISOR">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="math_constrain">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">50</field>
            </shadow>
          </value>
          <value name="LOW">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="HIGH">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_int">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_float"></block>
        <block type="math_atan2">
          <value name="X">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="Y">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
      </category>

      <category name="Import" colour="#ffe426">
        <block type="import_return"></block>
        <block type="import_statement"></block>
        <!--<block type="import_statement" id="123">
          <mutation func="Statement Function" args="2">
            <arg name="argA"/>
            <arg name="argB"/>
          </mutation>
        </block>-->
      </category>

      <category name="Sprite" colour="#0000ff" expanded="true">
        <label text="Motion"></label>
        <block type="sprite_moveSteps">
          <value name="STEPS">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_turnAngle">
          <value name="DEGREE">
            <shadow type="math_number">
              <field name="NUM">15</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_goTo"></block>
        <block type="sprite_goToPoint">
          <value name="X">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
          <value name="Y">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_glideTo">
          <value name="SEC">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_glideToPoint">
          <value name="SEC">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="X">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
          <value name="Y">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_pointTo">
          <value name="DIR">
            <shadow type="math_number">
              <field name="NUM">90</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_pointToward"></block>
        <block type="sprite_changeXY">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_setXY">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_edgeBounce"></block>
        <block type="sprite_rotationStyle"></block>
        <block type="sprite_getXY"></block>
        <block type="sprite_getDir"></block>

        <label text="Looks"></label>
        <block type="sprite_say">
          <value name="CONTENT">
            <shadow type="text">
              <field name="TEXT">Hello World!</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_sayTill">
          <value name="CONTENT">
            <shadow type="text">
              <field name="TEXT">Hello World!</field>
            </shadow>
          </value>
          <value name="SEC">
            <shadow type="math_number">
              <field name="NUM">2</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_think">
          <value name="CONTENT">
            <shadow type="text">
              <field name="TEXT">Hmm...</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_thinkTill">
          <value name="CONTENT">
            <shadow type="text">
              <field name="TEXT">Hmm...</field>
            </shadow>
          </value>
          <value name="SEC">
            <shadow type="math_number">
              <field name="NUM">2</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_nextCostume"></block>
        <block type="sprite_switchCostume"></block>
        <block type="sprite_nextBackdrop"></block>
        <block type="sprite_switchBackdrop"></block>
        <block type="sprite_changeSize">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_setSize">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_changeEffect">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">25</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_setEffect">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_clearEffect"></block>
        <block type="sprite_show"></block>
        <block type="sprite_hide"></block>
        <block type="sprite_setLayer"></block>
        <block type="sprite_changeLayer">
          <value name="COUNT">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_getCostume"></block>
        <block type="sprite_getBackdrop"></block>
        <block type="sprite_getSize"></block>

        <label text="Sounds"></label>
        <block type="sprite_playSound"></block>
        <block type="sprite_startSound"></block>
        <block type="sprite_stopSound"></block>
        <block type="sprite_changeSoundEffect">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_setSoundEffect">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_clearSoundEffect"></block>
        <block type="sprite_changeVolume">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">-10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_setVolume">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_getVolume"></block>

        <label text="Events"></label>
        <block type="sprite_flagClicked"></block>
        <block type="sprite_keyPressed">
          <field name="KEY">space</field>
        </block>
        <block type="sprite_spriteClicked"></block>
        <block type="sprite_backdropSwitched"></block>
        <block type="sprite_loudnessCondition">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_timerCondition">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_messageReceived"></block>
        <block type="sprite_messageBroadcast"></block>
        <block type="sprite_messageBroadcastWait"></block>

        <label text="Controls"></label>
        <block type="sprite_wait">
          <value name="SEC">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_repeat">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">3</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_forever"></block>
        <block type="sprite_if"></block>
        <block type="sprite_ifElse"></block>
        <block type="sprite_waitTill"></block>
        <block type="sprite_repeatTill"></block>
        <block type="sprite_stop"></block>
        <block type="sprite_cloneStarted"></block>
        <block type="sprite_createClone"></block>
        <block type="sprite_deleteClone"></block>

        <label text="Sensing"></label>
        <block type="sprite_touching"></block>
        <block type="sprite_touchingColor"></block>
        <block type="sprite_colorTouchingColor"></block>
        <block type="sprite_askWait">
          <value name="MESSAGE">
            <shadow type="text">
              <field name="TEXT">What's your name?</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_answer"></block>
        <block type="sprite_keyPress">
          <field name="KEY">space</field>
        </block>
        <block type="sprite_mouseDown"></block>
        <block type="sprite_getMouseXY">
          <field name="XY">x</field>
        </block>
        <block type="sprite_getMouseXY">
          <field name="XY">y</field>
        </block>
        <block type="sprite_setDragMode"></block>
        <block type="sprite_getLoudness"></block>
        <block type="sprite_getTimer"></block>
        <block type="sprite_resetTimer"></block>
        <block type="sprite_getStage"></block>
        <block type="sprite_getDate">
          <field name="OPTION">year</field>
        </block>
        <block type="sprite_getSince">
          <field name="OPTION">days</field>
        </block>
        <block type="sprite_getUsername"></block>

        <label text="Operators"></label>
        <block type="sprite_operator">
          <field name="OPTION">+</field>
          <value name="VALUE1">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">2</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_operator">
          <field name="OPTION">-</field>
          <value name="VALUE1">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">2</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_operator">
          <field name="OPTION">*</field>
          <value name="VALUE1">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">2</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_operator">
          <field name="OPTION">/</field>
          <value name="VALUE1">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">2</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_operator">
          <field name="OPTION">mod</field>
          <value name="VALUE1">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">2</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_getRandom">
          <value name="MIN">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="MAX">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_conditionalOperator">
          <field name="OPTION">></field>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_conditionalOperator">
          <field name="OPTION">=</field>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_conditionalOperator">
          <field name="OPTION"><</field>
          <value name="VALUE2">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_conditionalOperator">
          <field name="OPTION">and</field>
        </block>
        <block type="sprite_conditionalOperator">
          <field name="OPTION">or</field>
        </block>
        <block type="sprite_notOperator"></block>
        <block type="sprite_join">
          <value name="VALUE1">
            <shadow type="text">
              <field name="TEXT">pen</field>
            </shadow>
          </value>
          <value name="VALUE2">
            <shadow type="text">
              <field name="TEXT">pineapple</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_letterAt">
          <value name="INDEX">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT">pen-pineapple</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_length">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT">pen-pineapple</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_contains">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT">pen-pineapple</field>
            </shadow>
          </value>
          <value name="LOOKUP">
            <shadow type="text">
              <field name="TEXT">apple</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_unaryOperator">
          <field name="OPTION">round</field>
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">33.33</field>
            </shadow>
          </value>
        </block>
        <block type="sprite_unaryOperator">
          <field name="OPTION">abs</field>
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">-10</field>
            </shadow>
          </value>
        </block>


        <label text="Variables"></label>
        <block type="sprite_emptyList"></block>


        <!--
        <label text="EVENT"></label>
        <block type="sprite_flagClicked"></block>

        <label text="SENSE"></label>
        <block type="sprite_senseTouch">
          <value name="SPRITE">
            <block type="variables_get">
              <field name="VAR">sprite</field>
            </block>
          </value>
        </block>
        <block type="sprite_touch_color"></block>

        <label text="LOOK"></label>
        <block type="sprite_say"></block>

        <label text="CONTROL"></label>
        <block type="sprite_forever"></block>
        <block type="controls_if"></block>
        &lt;!&ndash;<block type="controls_if">
          <value name="ELSE"></value>
        </block>&ndash;&gt;

        <label text="LOGIC"></label>
        <block type="logic_negate"></block>
        <block type="logic_compare"></block>

        <label text="TEXT"></label>
        <block type="text_join"></block>

        <label text="VARIABLE"></label>
        <block type="sprite_empty_list">
          <value name="VARIABLE">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_indexOf"></block>
        <block type="lists_setIndex"></block>
        -->
      </category>

      <category name="Text" style="text_category">
        <block type="text"></block>
        <block type="text_join"></block>
        <block type="text_append">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_length">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_isEmpty">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
          <value name="FIND">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_charAt">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
        </block>
        <block type="text_getSubstring">
          <value name="STRING">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
        </block>
        <block type="text_changeCase">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_trim">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_count">
          <value name="SUB">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_replace">
          <value name="FROM">
            <shadow type="text"></shadow>
          </value>
          <value name="TO">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_reverse">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <label text="Input/Output:" web-class="ioLabel"></label>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_prompt_ext">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Lists" style="list_category">
        <block type="lists_create_with">
          <mutation items="0"></mutation>
        </block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">5</field>
            </shadow>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getIndex">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_setIndex">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getSublist">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_split">
          <value name="DELIM">
            <shadow type="text">
              <field name="TEXT">,</field>
            </shadow>
          </value>
        </block>
        <block type="lists_sort"></block>
        <block type="lists_reverse"></block>
      </category>
      <category name="Colour" style="colour_category">
        <block type="colour_picker"></block>
        <block type="colour_random"></block>
        <block type="colour_rgb">
          <value name="RED">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
          <value name="GREEN">
            <shadow type="math_number">
              <field name="NUM">50</field>
            </shadow>
          </value>
          <value name="BLUE">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="colour_blend">
          <value name="COLOUR1">
            <shadow type="colour_picker">
              <field name="COLOUR">#ff0000</field>
            </shadow>
          </value>
          <value name="COLOUR2">
            <shadow type="colour_picker">
              <field name="COLOUR">#3333ff</field>
            </shadow>
          </value>
          <value name="RATIO">
            <shadow type="math_number">
              <field name="NUM">0.5</field>
            </shadow>
          </value>
        </block>
      </category>
      <sep></sep>
      <category name="Variables" style="variable_category" custom="VARIABLE"></category>
      <category name="Functions" style="procedure_category" custom="PROCEDURE"></category>
    </xml>

    <!-- toolbox-categories-typed-variables has a category menu and an
    auto-closing flyout.  The Variables category uses typed variable blocks.
    See https://developers.google.com/blockly/guides/create-custom-blocks/variables#typed_variable_blocks for more information. -->
    <xml id="toolbox-categories-typed-variables" style="display: none">
      <category name="Logic" style="logic_category">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null" disabled="true"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Loops" style="loop_category">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="controls_repeat" disabled="true"></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
      <category name="Math" style="math_category">
        <block type="math_number" gap="32">
          <field name="NUM">123</field>
        </block>
        <block type="math_arithmetic">
          <value name="A">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="math_single">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">9</field>
            </shadow>
          </value>
        </block>
        <block type="math_trig">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">45</field>
            </shadow>
          </value>
        </block>
        <block type="math_constant"></block>
        <block type="math_number_property">
          <value name="NUMBER_TO_CHECK">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="math_round">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">3.1</field>
            </shadow>
          </value>
        </block>
        <block type="math_on_list"></block>
        <block type="math_modulo">
          <value name="DIVIDEND">
            <shadow type="math_number">
              <field name="NUM">64</field>
            </shadow>
          </value>
          <value name="DIVISOR">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="math_constrain">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM">50</field>
            </shadow>
          </value>
          <value name="LOW">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="HIGH">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_int">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_float"></block>
        <block type="math_atan2">
          <value name="X">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="Y">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Text" style="text_category">
        <block type="text"></block>
        <block type="text_join"></block>
        <block type="text_append">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_length">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_isEmpty">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
          <value name="FIND">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_charAt">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
        </block>
        <block type="text_getSubstring">
          <value name="STRING">
            <block type="variables_get">
              <field name="VAR">text</field>
            </block>
          </value>
        </block>
        <block type="text_changeCase">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_trim">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_count">
          <value name="SUB">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_replace">
          <value name="FROM">
            <shadow type="text"></shadow>
          </value>
          <value name="TO">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_reverse">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <label text="Input/Output:" web-class="ioLabel"></label>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_prompt_ext">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Lists" style="list_category">
        <block type="lists_create_with">
          <mutation items="0"></mutation>
        </block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">5</field>
            </shadow>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getIndex">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_setIndex">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getSublist">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR">list</field>
            </block>
          </value>
        </block>
        <block type="lists_split">
          <value name="DELIM">
            <shadow type="text">
              <field name="TEXT">,</field>
            </shadow>
          </value>
        </block>
        <block type="lists_sort"></block>
        <block type="lists_reverse"></block>
      </category>
      <category name="Colour" style="colour_category">
        <block type="colour_picker"></block>
        <block type="colour_random"></block>
        <block type="colour_rgb">
          <value name="RED">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
          <value name="GREEN">
            <shadow type="math_number">
              <field name="NUM">50</field>
            </shadow>
          </value>
          <value name="BLUE">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="colour_blend">
          <value name="COLOUR1">
            <shadow type="colour_picker">
              <field name="COLOUR">#ff0000</field>
            </shadow>
          </value>
          <value name="COLOUR2">
            <shadow type="colour_picker">
              <field name="COLOUR">#3333ff</field>
            </shadow>
          </value>
          <value name="RATIO">
            <shadow type="math_number">
              <field name="NUM">0.5</field>
            </shadow>
          </value>
        </block>
      </category>
      <sep></sep>
      <category name="Variables" style="variable_category" custom="VARIABLE_DYNAMIC"></category>
      <category name="Functions" style="procedure_category" custom="PROCEDURE"></category>
    </xml>
    <div id="importedFunctions">imported functions</div>
    <!-- toolbox-test-blocks has a category menu and an auto-closing flyout.
    The blocks in this toolbox reflect block configurations not used by
    the standard predefined blocks, and so test alernative block rendering
    code paths. -->
    <xml id="toolbox-test-blocks" style="display: none">
      <category name="Basic">
        <block type="empty_block"></block>
        <block type="empty_block_with_mutator"></block>
        <block type="value_to_stack"></block>
        <block type="value_to_statement"></block>
        <block type="limit_instances"></block>
      </category>
      <category name="Drag">
        <label text="Drag each to the workspace"></label>
        <block type="text_print">
          <value name="TEXT">
            <block type="text">
              <field name="TEXT">Drag me by this child</field>
            </block>
          </value>
        </block>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">Drag me by this shadow</field>
            </shadow>
          </value>
        </block>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">Shadow value</field>
            </shadow>
          </value>
          <next>
            <shadow type="text_print">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT">Shadow statement</field>
                </shadow>
              </value>
            </shadow>
          </next>
        </block>
        <label text="Multiple Variable Refs"></label>
        <block type="text_print">
          <value name="TEXT">
            <block type="variables_get">
              <field name="VAR" id="item" variabletype="">item</field>
            </block>
          </value>
          <next>
            <block type="text_print">
              <value name="TEXT">
                <block type="variables_get">
                  <field name="VAR" id="item" variabletype="">item</field>
                </block>
              </value>
            </block>
          </next>
        </block>
        <label text="Procedure Definitions"></label>
        <block type="procedures_defnoreturn">
          <field name="NAME">without arguments</field>
          <statement name="STACK">
            <block type="text_print">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT">No argument reference.</field>
                </shadow>
              </value>
            </block>
          </statement>
        </block>
        <block type="procedures_defnoreturn">
          <mutation>
            <arg name="fnArgument"></arg>
          </mutation>
          <field name="NAME">with one argument</field>
          <statement name="STACK">
            <block type="text_print">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT">Expected an argument reference here.</field>
                </shadow>
                <block type="variables_get">
                  <field name="VAR">fnArgument</field>
                </block>
              </value>
            </block>
          </statement>
        </block>
      </category>
      <category name="Fields">
        <label text="Numbers"></label>
        <block type="test_number">
          <field name="NUM">123.456</field>
        </block>
        <block type="test_integer">
          <field name="NUM">123.456</field>
        </block>
        <block type="test_number_hundredths">
          <field name="NUM">123.456</field>
        </block>
        <block type="test_integer_bounded">
          <field name="NOTE">60</field>
        </block>
        <label text="Drop-downs"></label>
        <block type="example_dropdown_long"></block>
        <block type="example_dropdown_images"></block>
        <block type="example_dropdown_images_and_text"></block>
        <label text="Dynamic Drop-downs"></label>
        <block type="test_dropdown_dynamic"></block>
        <button text="Add option" callbackKey="addDynamicOption"></button>
        <button text="Remove option" callbackKey="removeDynamicOption"></button>
        <label text="Others"></label>
        <block type="example_angle"></block>
        <block type="example_date"></block>
      </category>
      <category name="Mutators">
        <label text="logic_compare"></label>
        <block type="logic_compare">
          <value name="A">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="logic_compare">
          <value name="A">
            <block type="math_number">
              <field name="NUM">10</field>
            </block>
          </value>
          <value name="B">
            <block type="math_number">
              <field name="NUM">10</field>
            </block>
          </value>
        </block>
      </category>
      <category name="Style">
        <label text="Hats"></label>
        <block type="styled_event_cap"></block>
        <label text="Colour"></label>
        <block type="block_colour_hex1"></block>
        <block type="block_colour_hex2"></block>
        <block type="block_colour_hex3"></block>
        <block type="block_no_colour"></block>
        <block type="block_colour_hex4"></block>
        <block type="block_colour_hex5"></block>
      </category>
      <category name="Images">
        <block type="image_datauri"></block>
        <block type="image_small"></block>
        <block type="image_large"></block>
        <block type="image_fliprtl"></block>
        <block type="image_missing"></block>
        <block type="test_with_lots_of_network_icons"></block>
        <label text="Unicode & Emojis"></label>
        <block type="emoji_label_robot_face"></block>
        <block type="text">
          <field name="TEXT">Robot face in text field: &#x1f916;</field>
        </block>
        <block type="text">
          <field name="TEXT">Zalgo in text field: B&#776;&#788;&#862;&#795;&#842;&#827;&#806;&#837;&#812;&#792;&#816;&#846;&#805;l&#771;&#832;&#833;&#864;&#849;&#849;&#789;&#861;&#801;&#854;&#863;&#811;&#826;&#812;&#790;&#803;&#819;o&#843;&#777;&#778;&#785;&#831;&#829;&#794;&#825;&#857;&#814;&#802;&#811;&#852;c&#843;&#786;&#849;&#778;&#861;&#775;&#825;&#825;&#796;&#857;&#825;&#800;&#824;k&#778;&#850;&#833;&#774;&#772;&#782;&#862;&#770;&#789;&#788;&#841;&#801;&#811;&#860;&#839;&#790;&#819;&#854;l&#832;&#774;&#836;&#831;&#776;&#787;&#855;&#816;&#793;&#798;&#819;&#809;&#800;&#854;&#815;y&#864;&#783;&#856;&#773;&#832;&#808;&#799;&#839;&#814;&#840;&#812;&#793;&#818;&#801;</field>
        </block>
      </category>
    </xml>
  </div>
</div>

</body>
<script src="../../jszip/dist/jszip.js"></script>
<script src="../../FileSaver/dist/FileSaver.js"></script>
<script src="../../exportTest.js"></script>
<script src="../../blkImport.js"></script>
</html>
